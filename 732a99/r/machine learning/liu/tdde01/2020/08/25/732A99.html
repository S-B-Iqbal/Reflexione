<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>732A99 Machine Learning | Blogs</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="732A99 Machine Learning" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Helpful R-Code snippets to go along 732A99 course offered at Linköping University" />
<meta property="og:description" content="Helpful R-Code snippets to go along 732A99 course offered at Linköping University" />
<link rel="canonical" href="https://s-b-iqbal.github.io/Reflexione/732a99/r/machine%20learning/liu/tdde01/2020/08/25/732A99.html" />
<meta property="og:url" content="https://s-b-iqbal.github.io/Reflexione/732a99/r/machine%20learning/liu/tdde01/2020/08/25/732A99.html" />
<meta property="og:site_name" content="Blogs" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-25T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://s-b-iqbal.github.io/Reflexione/732a99/r/machine%20learning/liu/tdde01/2020/08/25/732A99.html","@type":"BlogPosting","headline":"732A99 Machine Learning","dateModified":"2020-08-25T00:00:00-05:00","datePublished":"2020-08-25T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://s-b-iqbal.github.io/Reflexione/732a99/r/machine%20learning/liu/tdde01/2020/08/25/732A99.html"},"description":"Helpful R-Code snippets to go along 732A99 course offered at Linköping University","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/Reflexione/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://s-b-iqbal.github.io/Reflexione/feed.xml" title="Blogs" /><link rel="shortcut icon" type="image/x-icon" href="/Reflexione/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/Reflexione/">Blogs</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/Reflexione/about/">About Me</a><a class="page-link" href="/Reflexione/search/">Search</a><a class="page-link" href="/Reflexione/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">732A99 Machine Learning</h1><p class="page-description">Helpful R-Code snippets to go along 732A99 course offered at Linköping University</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-08-25T00:00:00-05:00" itemprop="datePublished">
        Aug 25, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      46 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/Reflexione/categories/#732A99">732A99</a>
        &nbsp;
      
        <a class="category-tags-link" href="/Reflexione/categories/#R">R</a>
        &nbsp;
      
        <a class="category-tags-link" href="/Reflexione/categories/#machine learning">machine learning</a>
        &nbsp;
      
        <a class="category-tags-link" href="/Reflexione/categories/#LiU">LiU</a>
        &nbsp;
      
        <a class="category-tags-link" href="/Reflexione/categories/#TDDE01">TDDE01</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#1-Preprocessing">Data-Manipulation</a>
<ul>
<li class="toc-entry toc-h3"><a href="#1-load-excel">1.1 Load Excel Data</a></li>
<li class="toc-entry toc-h3"><a href="#1-denormalize">1.2 Denormalize normalized data</a></li>
<li class="toc-entry toc-h3"><a href="#1-train-test">1.3 Train/Test Split</a></li>
<li class="toc-entry toc-h3"><a href="#1-t-t-v">1.3 Train/Test/Validation Split</a></li>
<li class="toc-entry toc-h3"><a href="#1-binarize">1.4 Dichotomization</a></li>
<li class="toc-entry toc-h3"><a href="#1-formula">1.5 Writing Custom formula</a></li>
<li class="toc-entry toc-h3"><a href="#1-gaussian">1.6 Gaussian Kernel</a></li>
<li class="toc-entry toc-h3"><a href="#1-vignette">1.7 Package Vignette</a></li>
<li class="toc-entry toc-h3"><a href="#1-metrics">1.8 Metrics</a></li>
<li class="toc-entry toc-h3"><a href="#1-plot">1.9 Plotting Help</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#2-head">Supervised Learning</a>
<ul>
<li class="toc-entry toc-h3"><a href="#2-nn-r">Neural-Net Regression</a></li>
<li class="toc-entry toc-h3"><a href="#2-em-b">EM : Multivariate Bernoulli</a></li>
<li class="toc-entry toc-h3"><a href="#2-em-g">EM: Mixture of Gaussians</a></li>
<li class="toc-entry toc-h3"><a href="#2-gam">GAM(Generalized Additive Models)</a></li>
<li class="toc-entry toc-h3"><a href="#2-kde">Kernel Classification(using Kernel Density Estimation)</a></li>
<li class="toc-entry toc-h3"><a href="#2-lda">LDA(Manual implementation can be extended to QDA and Naive Bayes)</a></li>
<li class="toc-entry toc-h3"><a href="#2-qda">QDA</a></li>
<li class="toc-entry toc-h3"><a href="#2-dt">Decision Trees: Classification/Regression</a></li>
<li class="toc-entry toc-h3"><a href="#2-splines">Splines: Using base R Functions only</a></li>
<li class="toc-entry toc-h3"><a href="#2-splines2">Splines: Using splines library</a></li>
<li class="toc-entry toc-h3"><a href="#2-logistic">Logistic Regression</a></li>
<li class="toc-entry toc-h3"><a href="#2-knn">K Nearest Neighbors</a></li>
<li class="toc-entry toc-h3"><a href="#2-ridge">Ridge Regression</a></li>
<li class="toc-entry toc-h3"><a href="#2-poisson">Poisson Regression</a></li>
<li class="toc-entry toc-h3"><a href="#2-ridge-optim">Ridge Regression using Optim</a></li>
<li class="toc-entry toc-h3"><a href="#2-lasso">LASSO</a></li>
<li class="toc-entry toc-h3"><a href="#2-elastic">Elastic-Net</a></li>
<li class="toc-entry toc-h3"><a href="#2-svm">SVM</a></li>
<li class="toc-entry toc-h3"><a href="#2-bag">Experimental Estimation of Bagging Error</a></li>
<li class="toc-entry toc-h3"><a href="#2-nn-scratch">NN from Scratch</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#2-head">Unsupervised Learning</a>
<ul>
<li class="toc-entry toc-h3"><a href="#nsc">Nearest Shrunken Centroid</a></li>
<li class="toc-entry toc-h3"><a href="#pca">PCA</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#2-head">Other Topics</a>
<ul>
<li class="toc-entry toc-h3"><a href="#npb">Non-Parametric Bootstrap</a></li>
<li class="toc-entry toc-h3"><a href="#pb-r">Parametric Bootstrap(Regression)</a></li>
<li class="toc-entry toc-h3"><a href="#pb-c">Parametric Bootstrap(Classification)</a></li>
<li class="toc-entry toc-h3"><a href="#bonferroni">Bonferroni Method</a></li>
<li class="toc-entry toc-h3"><a href="#b-h">Benjamin-Hochberg</a></li>
<li class="toc-entry toc-h3"><a href="#n-cv">N-Fold CV</a></li>
<li class="toc-entry toc-h3"><a href="#step-aic">Variable Selection using StepAIC</a></li>
<li class="toc-entry toc-h3"><a href="#nested-cv">Nested Cross-Validation</a></li>
<li class="toc-entry toc-h3"><a href="#laplace">Laplace Prior</a></li>
<li class="toc-entry toc-h3"><a href="#entropy">Entropy</a></li>
</ul>
</li>
</ul><h2 id="1-Preprocessing">
<a class="anchor" href="#1-Preprocessing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data-Manipulation</h2>

<h3 id="1-load-excel">
<a class="anchor" href="#1-load-excel" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.1 Load Excel Data</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"readxl"</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="s1">'spambase.xlsx'</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="s1">'spambase.xls'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="1-denormalize">
<a class="anchor" href="#1-denormalize" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.2 Denormalize normalized data</h3>

<ul>
  <li>Collect $\textit{max}_x$, $\textit{min}_x$</li>
  <li>Apply the formula on all $\textit{x}$ : $\textit{x}$ * ( $\textit{max}_x$ - $\textit{min}_x$ ) + $\textit{min}_x$</li>
</ul>

<h3 id="1-train-test">
<a class="anchor" href="#1-train-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.3 Train/Test Split</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">12345</span><span class="p">)</span><span class="w">
</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="m">0.5</span><span class="p">))</span><span class="w">
</span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">id</span><span class="p">,]</span><span class="w">
</span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">id</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<h3 id="1-t-t-v">
<a class="anchor" href="#1-t-t-v" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.3 Train/Test/Validation Split</h3>

<ul>
  <li>Also Available in Lecture: Block 1(e)]</li>
  <li>Contains example on how to perform Cross-Validation given that there is a function <code class="language-plaintext highlighter-rouge">loss</code> to estimate the loss.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.6</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.2</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">cut</span><span class="p">(</span><span class="w">
  </span><span class="n">seq</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)),</span><span class="w"> 
  </span><span class="n">nrow</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="o">*</span><span class="nf">cumsum</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">spec</span><span class="p">)),</span><span class="w">
  </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w">
</span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">)</span><span class="w">
</span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">train</span><span class="w">
</span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">test</span><span class="w">
</span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">validate</span><span class="w">
</span><span class="c1"># Cross Validation</span><span class="w">
</span><span class="n">n_fold_cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">n_fold</span><span class="p">){</span><span class="w">
  </span><span class="c1">#Randomly shuffle the data</span><span class="w">
  </span><span class="n">ran_ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">ran_ind</span><span class="p">,]</span><span class="w">
  </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="n">ran_ind</span><span class="p">]</span><span class="w">
  </span><span class="c1">#Create n equally size folds</span><span class="w">
  </span><span class="n">folds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span><span class="n">breaks</span><span class="o">=</span><span class="n">n_fold</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  </span><span class="c1">#Perform 10 fold cross validation</span><span class="w">
  </span><span class="n">cv_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n_fold</span><span class="p">){</span><span class="w">
    </span><span class="c1">#Segement your data by fold using the which() function </span><span class="w">
    </span><span class="n">testIndexes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">folds</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="n">arr.ind</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
    </span><span class="n">xTest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">testIndexes</span><span class="p">,]</span><span class="w">
    </span><span class="n">yTest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="n">testIndexes</span><span class="p">]</span><span class="w">
    </span><span class="n">xTrain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="n">testIndexes</span><span class="p">,]</span><span class="w">
    </span><span class="n">yTrain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="n">testIndexes</span><span class="p">]</span><span class="w">
    </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loss</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xTrain</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yTrain</span><span class="p">,</span><span class="n">xTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xTest</span><span class="p">,</span><span class="w"> </span><span class="n">yTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yTest</span><span class="p">)</span><span class="w">
    </span><span class="n">cv_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">cv_loss</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">cv_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">cv_loss</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">cv_loss</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="1-binarize">
<a class="anchor" href="#1-binarize" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.4 Dichotomization</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spam</span><span class="o">$</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">spam</span><span class="o">$</span><span class="n">Spam</span><span class="o">==</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'S'</span><span class="p">,</span><span class="s1">'H'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Create a binary variable</span><span class="w">
</span><span class="n">spam</span><span class="o">$</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">spam</span><span class="o">$</span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="c1"># Convert to Factor</span><span class="w">
</span><span class="n">contrasts</span><span class="p">(</span><span class="n">spam</span><span class="o">$</span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="c1"># Check the factor</span><span class="w">
</span></code></pre></div></div>

<h3 id="1-formula">
<a class="anchor" href="#1-formula" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.5 Writing Custom formula</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">covariates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">spam</span><span class="p">)[</span><span class="m">0</span><span class="o">:</span><span class="m">48</span><span class="p">]</span><span class="w"> </span><span class="c1"># Collect Covariates 1st</span><span class="w">
</span><span class="n">cov</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="n">covariates</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s1">'+'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Collapse the covariates</span><span class="w">
</span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s1">'target~'</span><span class="p">,</span><span class="n">cov</span><span class="p">))</span><span class="w"> </span><span class="c1"># Create the formula with the target</span><span class="w">
</span></code></pre></div></div>

<h3 id="1-gaussian">
<a class="anchor" href="#1-gaussian" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.6 Gaussian Kernel</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">h</code> specifies Kernel Width</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gaussian_k</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">)))</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h3 id="1-vignette">
<a class="anchor" href="#1-vignette" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.7 Package Vignette</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">utils</span><span class="o">::</span><span class="n">browseVignettes</span><span class="p">(</span><span class="s2">"gbm"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Package Name</span><span class="w">
</span></code></pre></div></div>
<h3 id="1-metrics">
<a class="anchor" href="#1-metrics" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.8 Metrics</h3>

<ul>
  <li>Look at data imbalance when quoting misclassification.</li>
  <li>Misclassification rate : $\textbf{1 - Accuracy    OR  }\frac{\text{FP+FN}}{total}$ |  Accuracy : $\frac{TP+TN}{total}$</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">train</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">prediction</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Sensitivity/Recal/True Positive Rate: $\frac{TP}{\text{Actual Yes}}$</li>
  <li>Specificity/False Positive Rate: $\frac{\text{FP}}{\textbf{Actual NO}}$
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">get.rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">predicted.prob</span><span class="p">,</span><span class="w"> </span><span class="n">actual</span><span class="p">,</span><span class="w"> </span><span class="n">true_label</span><span class="p">,</span><span class="w"> </span><span class="n">false_label</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="p">){</span><span class="w">
</span><span class="n">prediction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">predicted.prob</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">,</span><span class="w"> </span><span class="n">true_label</span><span class="p">,</span><span class="n">false_label</span><span class="p">)</span><span class="w">
</span><span class="n">TPR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">prediction</span><span class="o">==</span><span class="n">true_label</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">true_label</span><span class="p">)</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">actual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">true_label</span><span class="p">)</span><span class="w">
</span><span class="n">FPR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">prediction</span><span class="o">==</span><span class="n">true_label</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">false_label</span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">actual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">false_label</span><span class="p">)</span><span class="w">
</span><span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">TPR</span><span class="p">,</span><span class="w"> </span><span class="n">FPR</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>AIC/BIC/$C_p$:
    <ul>
      <li>Can be used for estimating only ‘In-Sample’ errors for ‘Linear’ Parameters.  <br>
  ‘In-Sample’ is not beneficial as it does not represent generalized error i.e., how the model will perform on ‘Unseen’ data.</li>
      <li>AIC Formula: $\frac{-2}{N}\cdot\text{log-likelihood}+ 2\cdot\frac{degree of freedom}{N}$ where $\text{N = No of datapoints}$</li>
      <li>BIC Formula: $\textit{Log-Likelihood} - \frac{M}{2} \cdot \ln(N)$ where $M$ is the no. of parameters. $N$ = # of datapoints.
        <ul>
          <li><code class="language-plaintext highlighter-rouge">BIC = function(LL,M,N){return(LL - (0.5*M/log(N)))}</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Loss Matrix:
    <ul>
      <li>Make sure the loss matrix and prediction order is same. Ex: if loss is <code class="language-plaintext highlighter-rouge">c("cat","dog")</code> then predicted probability columns should also be: <code class="language-plaintext highlighter-rouge">pred_prob[,c("cat","dog")]</code>
</li>
      <li>Then use <code class="language-plaintext highlighter-rouge">apply(pred_prob%*%loss_matrix,MARGIN=1,FUN=which.max)</code>. Use the index same as <code class="language-plaintext highlighter-rouge">c("cat","dog")</code> for classification.</li>
    </ul>
  </li>
</ul>

<h3 id="1-plot">
<a class="anchor" href="#1-plot" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.9 Plotting Help</h3>

<p>refer: https://bookdown.org/rdpeng/exdata/the-base-plotting-system-1.html#base-plotting-functions</p>

<h2 id="2-head">
<a class="anchor" href="#2-head" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supervised Learning</h2>
<hr>

<h3 id="2-nn-r">
<a class="anchor" href="#2-nn-r" aria-hidden="true"><span class="octicon octicon-link"></span></a>Neural-Net Regression</h3>

<ul>
  <li>
<strong>STEP-1</strong>: Standardize the Data. If Test set is unseen, then use ‘mean’ and ‘variance’ of training data.</li>
  <li>
<code class="language-plaintext highlighter-rouge">y~.</code> does not work, formula needs to be specified specifically.</li>
  <li>
<code class="language-plaintext highlighter-rouge">linear.output=TRUE</code> should be chosen.</li>
  <li>
<code class="language-plaintext highlighter-rouge">threshold</code> specifies the change in Error(given by <code class="language-plaintext highlighter-rouge">nn.fit$err.fct</code>) over the epochs(also referred as ‘Steps’)</li>
  <li>Custom activation function should go into: <code class="language-plaintext highlighter-rouge">act.fct</code>:
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">RelU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="m">0</span><span class="p">)}</span><span class="w"> </span><span class="c1"># RELU Implementation</span><span class="w">
</span><span class="n">nn.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">neuralnet</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">hidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="n">linear.output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">act.fct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RelU</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">neuralnet</span><span class="p">)</span><span class="w">
</span><span class="n">Var</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">trva</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span><span class="w"> </span><span class="n">Sin</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="n">Var</span><span class="p">))</span><span class="w">
</span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">trva</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">25</span><span class="p">,]</span><span class="w"> </span><span class="c1"># Training</span><span class="w">
</span><span class="n">va</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">trva</span><span class="p">[</span><span class="m">26</span><span class="o">:</span><span class="m">50</span><span class="p">,]</span><span class="w"> </span><span class="c1"># Validation</span><span class="w">
</span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"Sin~Var"</span><span class="p">)</span><span class="w">
</span><span class="n">winit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">nn.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">neuralnet</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">rep</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">hidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="n">linear.output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
               </span><span class="n">startweights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">winit</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">nn.fit</span><span class="p">,</span><span class="w"> </span><span class="n">show.weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">## Prediction</span><span class="w">
</span><span class="n">yTestPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute</span><span class="p">(</span><span class="n">nn.fit</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nn.fit</span><span class="p">)</span><span class="o">$</span><span class="n">rep1</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">trva</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">## Test Results</span><span class="w">
</span><span class="n">yTestPred</span><span class="o">$</span><span class="n">net.result</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">yTestPred</span><span class="o">$</span><span class="n">net.result</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">va</span><span class="o">$</span><span class="n">Sin</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>
<h3 id="2-em-b">
<a class="anchor" href="#2-em-b" aria-hidden="true"><span class="octicon octicon-link"></span></a>EM : Multivariate Bernoulli</h3>

<ul>
  <li>In case of Binary Data, use ‘bernoulli’ priors</li>
  <li>In case of Multiclass data, use ‘dirichlet’ priors!</li>
  <li>In contrast to the mixture of Gaussians, there are no singularities in which the likelihood function goes to infinity.This can be seen by noting that the
likelihood function is bounded because $\text{0 }\le p(\mathbf{x_n|\mu_k}) \le \text{ 1}$</li>
  <li>$\text{Log-Likelihood :} \ln p(\textbf{X} | \mu, \pi)  = \displaystyle \sum_{n=1}^{N} \ln {\sum_{k=1}^{K} \pi_{k} p(\mathbf{x_n} | \mathbf{\mu_k})  }$ where $p(\mathbf{x_n} | \mathbf{\mu_k}) = \displaystyle \prod_{i=1}^{D} \mu_i^{x_i} \left(1 - \mu_i \right)^{1 - x_i}$ i.e., $x_n$ datapoint with $D$ “binary” variables.</li>
  <li>Algo Steps:
    <ol>
      <li>Use $\text{Eq. 9.54}$ to get the $\textbf{Complete Data Log Likelihood}$</li>
      <li>Use $\text{Eq. 9.56}$ to get the responsibility($\gamma(z_{nk})$) of component $k$ given datapoint $\mathbf{x}_n$ for which we get a <code class="language-plaintext highlighter-rouge">resp</code> matrix of dim $[N,K]$</li>
      <li>Now is M-Step:  <br>
  3.1. Calculate $N_k$ using $\text{Eq. 9.57}$. : <code class="language-plaintext highlighter-rouge">N_k = colSums(resp)</code>  <br>
  3.2. Use $\text{Eq. 9.58}$ to get $\bar{x}$.: <code class="language-plaintext highlighter-rouge">x_k = t(resp)%*%x # same dimension as mu</code>  <br>
  3.3. Update $\mathbf{\mu}_k = \bar{x}$: <code class="language-plaintext highlighter-rouge">mu[k,] = x_k[k,]/N_k[k] # Using eq. 9.58 and 9.59</code>  <br>
  3.3. Update $\pi_k$ using <strong>Eq 9.60</strong> : <code class="language-plaintext highlighter-rouge">pi = N_k/N # eq. 9.60</code>
</li>
    </ol>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w"> </span><span class="c1">## For Piping  </span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1234567890</span><span class="p">)</span><span class="w">
</span><span class="n">max_it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">min_change</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="w">
</span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">D</span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">)</span><span class="w">
</span><span class="n">true_pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">true_mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">D</span><span class="p">)</span><span class="w">
</span><span class="n">true_pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">true_mu</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.6</span><span class="p">,</span><span class="m">0.4</span><span class="p">,</span><span class="m">0.7</span><span class="p">,</span><span class="m">0.3</span><span class="p">,</span><span class="m">0.8</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.9</span><span class="p">,</span><span class="m">0.1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">true_mu</span><span class="p">[</span><span class="m">2</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.4</span><span class="p">,</span><span class="m">0.6</span><span class="p">,</span><span class="m">0.3</span><span class="p">,</span><span class="m">0.7</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.8</span><span class="p">,</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.9</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">true_mu</span><span class="p">[</span><span class="m">3</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">true_mu</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">true_mu</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">true_mu</span><span class="p">[</span><span class="m">3</span><span class="p">,],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Training Data</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">){</span><span class="w">
   </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">true_pi</span><span class="p">)</span><span class="w">
   </span><span class="k">for</span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">D</span><span class="p">){</span><span class="w">
     </span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">true_mu</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">])</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c1"># Guessed components</span><span class="w">
</span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="p">)</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">D</span><span class="p">)</span><span class="w">
</span><span class="n">llik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_it</span><span class="p">)</span><span class="w">
</span><span class="c1"># Random Initialization of the Parameters</span><span class="w">
</span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="m">0.49</span><span class="p">,</span><span class="m">0.51</span><span class="p">)</span><span class="w">
</span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">pi</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="nb">pi</span><span class="p">)</span><span class="w">  </span><span class="c1"># Sum = 1 for 'Mixing Coefficients'</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">){</span><span class="w">
    </span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="m">0.49</span><span class="p">,</span><span class="m">0.51</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">max_it</span><span class="p">){</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
  </span><span class="n">points</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
  </span><span class="n">points</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="m">3</span><span class="p">,],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span><span class="w">
  </span><span class="c1"># points(mu[3,], type="o", col="black")</span><span class="w">
  </span><span class="n">Sys.sleep</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span><span class="w">
  </span><span class="c1"># E-Step</span><span class="w">
  </span><span class="c1"># Measure Log-Likelihood</span><span class="w">
  </span><span class="n">lik1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">){</span><span class="w">
    </span><span class="n">lik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="w">
    </span><span class="c1"># Log-likelihood for 1 datapoint</span><span class="w">
    </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">){</span><span class="w">
      </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="nb">pi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"> </span><span class="c1"># Log(pi_k)</span><span class="w">
      </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">,]</span><span class="o">*</span><span class="nf">log</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,])</span><span class="w"> </span><span class="c1"># x_{nd} * log(mu_{kd}) # for d columns</span><span class="w">
      </span><span class="n">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">,])</span><span class="o">*</span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,])</span><span class="w"> </span><span class="c1"># (1 - x_{nd}) * log(1 - mu_{kd}) # for d columns</span><span class="w">
      </span><span class="n">lik</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">t2</span><span class="o">+</span><span class="n">t3</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">lik</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lik1</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="o">=</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="c1">## Eq 9.54</span><span class="w">
  </span><span class="n">cat</span><span class="p">(</span><span class="s2">"iteration: "</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="s2">" Lig-Likelihood: "</span><span class="p">,</span><span class="w"> </span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="p">],</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Calculating responsibility  resp = matrix(nrow = N, ncol = K) # holds eq. 9.56 variable i.e., responsibility</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">){</span><span class="w">
    </span><span class="n">total_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="w">
    </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">){</span><span class="w">
      </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="nb">pi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w">
      </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">,]</span><span class="o">*</span><span class="nf">log</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,]))</span><span class="w">
      </span><span class="n">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">,])</span><span class="o">*</span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,])</span><span class="w">
      </span><span class="n">total_k</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">t2</span><span class="o">+</span><span class="n">t3</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
      </span><span class="n">total_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">total_k</span><span class="p">)</span><span class="w">
      </span><span class="n">total_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total_k</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">total_k</span><span class="p">)</span><span class="w">
      </span><span class="n">resp</span><span class="p">[</span><span class="n">n</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total_k</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1"># M- Step</span><span class="w">
  </span><span class="n">N_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colSums</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="c1"># 9.57</span><span class="w">
  </span><span class="n">cat</span><span class="p">(</span><span class="s2">"N_k: "</span><span class="p">,</span><span class="w"> </span><span class="n">N_k</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
  </span><span class="n">x_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="o">%*%</span><span class="n">x</span><span class="w"> </span><span class="c1"># same dimension as mu</span><span class="w">
  </span><span class="c1"># Update mu</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">){</span><span class="w">
    </span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_k</span><span class="p">[</span><span class="n">k</span><span class="p">,]</span><span class="o">/</span><span class="n">N_k</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="c1"># Using eq. 9.58 and 9.59</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1"># Update pi</span><span class="w">
  </span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_k</span><span class="o">/</span><span class="n">N</span><span class="w"> </span><span class="c1"># eq. 9.60</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="n">it</span><span class="o">&gt;</span><span class="m">1</span><span class="p">){</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="m">-1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="p">])</span><span class="o">&lt;</span><span class="n">min_change</span><span class="p">)</span><span class="k">break</span><span class="w">
  </span><span class="k">else</span><span class="p">{</span><span class="n">print</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="m">-1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="p">]),</span><span class="w"> </span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">))}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-em-g">
<a class="anchor" href="#2-em-g" aria-hidden="true"><span class="octicon octicon-link"></span></a>EM: Mixture of Gaussians</h3>

<ul>
  <li>Initial $\mu$ and $\Sigma$ can be obtained using <code class="language-plaintext highlighter-rouge">kmeans</code>
</li>
  <li>We have $\text{Log-Likelihood :} \ln p(\textbf{X}|\mu, \pi,\Sigma)  = \displaystyle \sum_{n=1}^{N}  \sum_{k=1}^{K} { \ln \pi_{k} +\ln \mathcal{N}(\mathbf{x}_n | \mathbf{\mu}_k, \Sigma_k)  }$</li>
  <li>
<strong>E-Step</strong>:
    <ul>
      <li>Evaluate the responsibility using <strong>Eq. 9.23</strong>. Implemented by the function <code class="language-plaintext highlighter-rouge">e_step</code>
</li>
    </ul>
  </li>
  <li>
<strong>M-Step</strong>:
    <ul>
      <li>First get $N_k$ for <strong>Eq. 9.27</strong> using <code class="language-plaintext highlighter-rouge">colSums(e_step(...))</code> saved in <code class="language-plaintext highlighter-rouge">N_k</code> variable</li>
      <li>Get Updates $\mathbf{\mu}_k^{new}$ using <strong>Eq. 9.24</strong> and function <code class="language-plaintext highlighter-rouge">update_mu</code>
</li>
      <li>Get Updated $\mathbf{\pi}_k^{new}$ using <strong>Eq. 9.26</strong> and <code class="language-plaintext highlighter-rouge">update_pi</code> function.</li>
      <li>
<strong>CAREFUL!</strong> For getting $\Sigma_K^{new}$, we have two steps:
        <ul>
          <li>Use function <code class="language-plaintext highlighter-rouge">cov_k</code> to get $\gamma(\textit{z}_{nk})(\mathbf{x}_n - \mathbf{\mu}_k^{new})\left(\mathbf{x}_n - \mathbf{\mu}_k^{new} \right)^{T}$ for only 1 datapoint.</li>
          <li>Now apply <code class="language-plaintext highlighter-rouge">cov_k</code> function on all data-points and sum them up: <code class="language-plaintext highlighter-rouge">sigmaK = sapply(1:N, FUN = cov_k, df = df, K=k,z = z) %&gt;% rowSums</code>
</li>
          <li>Re-arrange the co-variance matrix: <code class="language-plaintext highlighter-rouge">sigmaK = matrix(sigmaK, ncol=D, byrow = T)</code>
</li>
          <li>In case We need it to be only-diagonal matrix: <code class="language-plaintext highlighter-rouge">sigmA[k,,] = diag(diag(sigmaK)/N_k[k]) ## Only Diagonals</code>
</li>
          <li>If we dont want it to be non-diagonal: <code class="language-plaintext highlighter-rouge">sigmA[k,,] = sigmaK/N_k[k]) ## We need to divide by N_k[k]</code>
</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w"> </span><span class="c1">## For Piping</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">mvtnorm</span><span class="p">)</span><span class="w">
</span><span class="n">dataEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="s2">"dataEM.txt"</span><span class="p">))</span><span class="w">
</span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">dataEM</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">dataEM</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1"># Can be columns</span><span class="w">
</span><span class="n">df</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">dataEM</span><span class="p">)</span><span class="w">



</span><span class="n">x_density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">){</span><span class="w">
 
  </span><span class="n">vK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">){</span><span class="w">
    
    </span><span class="n">vK</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="nb">pi</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dmvnorm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">n</span><span class="p">,],</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,],</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigmA</span><span class="p">[</span><span class="n">k</span><span class="p">,,],</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">vK</span><span class="p">))</span><span class="w">  </span><span class="c1"># x_density and CDLL need to be outside EM function as they are helper</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">CDLL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">){</span><span class="w">
  
  </span><span class="n">loglik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_density</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">sum</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">loglik</span><span class="p">)</span><span class="w"> </span><span class="c1"># Observe Complete Data Log Likelihood</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># EM-Function</span><span class="w">
</span><span class="n">EM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">){</span><span class="w">
  </span><span class="c1"># E-Step</span><span class="w">
  </span><span class="n">e_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">,</span><span class="w"> </span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigmA</span><span class="p">){</span><span class="w">
    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="p">)</span><span class="w">
    </span><span class="k">for</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">){</span><span class="w">
      </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">){</span><span class="w">
        </span><span class="c1"># z[n,k] is the numerator in eq. 9.23</span><span class="w">
        </span><span class="n">z</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nb">pi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">dmvnorm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">n</span><span class="p">,],</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,],</span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigmA</span><span class="p">[</span><span class="n">k</span><span class="p">,,])</span><span class="w"> 
      </span><span class="p">}</span><span class="w">
      
      </span><span class="n">z</span><span class="p">[</span><span class="n">n</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="n">n</span><span class="p">,]</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">n</span><span class="p">,])</span><span class="w"> </span><span class="c1"># Eq 9.23</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e_step</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="o">=</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigmA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigmA</span><span class="p">)</span><span class="w">
  </span><span class="n">N_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colSums</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="c1">##M - step</span><span class="w">
  </span><span class="c1"># pi</span><span class="w">
  </span><span class="n">update_pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">){</span><span class="w">
    </span><span class="n">pi_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colSums</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="w">
    </span><span class="n">pi_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pi_m</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">pi_m</span><span class="p">)</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">pi_m</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_pi</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w">
  </span><span class="c1"># mu</span><span class="w">
  </span><span class="n">update_mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">Nk</span><span class="p">){</span><span class="w">
    </span><span class="n">mu_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">%*%</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="n">Nk</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">mu_m</span><span class="p">)))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_mu</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">Nk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_k</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Update Sigma</span><span class="w">
  </span><span class="n">cov_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">){</span><span class="w">
    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">n</span><span class="p">,]</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">n</span><span class="p">,]))</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">val</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">){</span><span class="w">
    </span><span class="n">sigmaK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cov_k</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">rowSums</span><span class="w">
    </span><span class="n">sigmaK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">sigmaK</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">byrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
    </span><span class="n">sigmA</span><span class="p">[</span><span class="n">k</span><span class="p">,,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diag</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">sigmaK</span><span class="p">)</span><span class="o">/</span><span class="n">N_k</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"> </span><span class="c1">## Only Diagonals</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">llik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CDLL</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">)</span><span class="w"> </span><span class="c1">## CDLL is designed as a global function</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigmA</span><span class="p">,</span><span class="w"> </span><span class="n">LLik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llik</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1">## Function to run EM Algorithm</span><span class="w">
</span><span class="n">RUN_EM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">,</span><span class="n">max_it</span><span class="p">,</span><span class="n">delta</span><span class="p">){</span><span class="w">
  </span><span class="n">llik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_it</span><span class="p">)</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">max_it</span><span class="p">){</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">it</span><span class="o">==</span><span class="m">1</span><span class="p">){</span><span class="w">
      </span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CDLL</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">)</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EM</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">)</span><span class="w">
      </span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">$</span><span class="nb">pi</span><span class="w">
      </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">$</span><span class="n">mu</span><span class="w">
      </span><span class="n">sigmA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">$</span><span class="n">sigma</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="k">else</span><span class="p">{</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EM</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">)</span><span class="w">
      </span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">$</span><span class="nb">pi</span><span class="w">
      </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">$</span><span class="n">mu</span><span class="w">
      </span><span class="n">sigmA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">$</span><span class="n">sigma</span><span class="w"> 
      </span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">$</span><span class="n">LLik</span><span class="w">
      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">llik</span><span class="p">[</span><span class="n">it</span><span class="m">-1</span><span class="p">])</span><span class="o">&lt;</span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="k">break</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigmA</span><span class="p">,</span><span class="w"> </span><span class="n">LLik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llik</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1">## RUN EXPERIMENT</span><span class="w">
</span><span class="n">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c1"># Columns </span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">)</span><span class="w">
</span><span class="n">sigmA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="n">dim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="c1"># K X [D X D]</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">){</span><span class="w">
  </span><span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="n">sigmA</span><span class="p">[</span><span class="n">k</span><span class="p">,,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diag</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">D</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="m">0.4</span><span class="p">,</span><span class="m">0.6</span><span class="p">)</span><span class="w">
</span><span class="nb">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">pi</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="nb">pi</span><span class="p">)</span><span class="w">
</span><span class="n">max_it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="w">
</span><span class="n">result_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RUN_EM</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">sigmA</span><span class="p">,</span><span class="n">max_it</span><span class="p">,</span><span class="n">delta</span><span class="p">)</span><span class="w">
</span><span class="c1"># Plot</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">result_2</span><span class="o">$</span><span class="n">LLik</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="n">result_2</span><span class="o">$</span><span class="n">iterations</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Plot only Non-Zero Log-Likelihoods</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">result_3</span><span class="o">$</span><span class="n">LLik</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">result_3</span><span class="o">$</span><span class="n">iterations</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">result_4</span><span class="o">$</span><span class="n">LLik</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="n">result_4</span><span class="o">$</span><span class="n">iterations</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="c1"># Calculate Bayesian Info Criteria</span><span class="w">
</span><span class="n">BIC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">LL</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">){</span><span class="nf">return</span><span class="p">(</span><span class="n">LL</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">M</span><span class="o">/</span><span class="nf">log</span><span class="p">(</span><span class="n">N</span><span class="p">)))}</span><span class="w">
</span><span class="n">BIC2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BIC</span><span class="p">(</span><span class="n">LL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result_2</span><span class="o">$</span><span class="n">LLik</span><span class="p">[</span><span class="n">result_2</span><span class="o">$</span><span class="n">iterations</span><span class="p">],</span><span class="w"> </span><span class="n">M</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="m">600</span><span class="p">)</span><span class="w">   
   
</span></code></pre></div></div>

<h3 id="2-gam">
<a class="anchor" href="#2-gam" aria-hidden="true"><span class="octicon octicon-link"></span></a>GAM(Generalized Additive Models)</h3>

<ul>
  <li>Notes for Library <code class="language-plaintext highlighter-rouge">mgcv</code>
    <ul>
      <li>Non-Linear Effects can be entered via <code class="language-plaintext highlighter-rouge">s</code> or <code class="language-plaintext highlighter-rouge">te</code>:</li>
      <li>Use <code class="language-plaintext highlighter-rouge">method = "REML"</code>
</li>
      <li>always look at <code class="language-plaintext highlighter-rouge">gam.check()</code>
</li>
      <li>Parameters:
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">s</code> in <code class="language-plaintext highlighter-rouge">gam(y~x0+s(x1)+s(x2,x3))</code> is the smoothing function:
            <ul>
              <li>
<code class="language-plaintext highlighter-rouge">k</code> specifies dimensions to represent smoothing term: ALWAYS equal to the length: <code class="language-plaintext highlighter-rouge">Mortality~Year+s(Week, k = length(unique(data1$Week)))</code>
</li>
              <li>
<code class="language-plaintext highlighter-rouge">bs</code> specifies the penalized smoothing basis: <code class="language-plaintext highlighter-rouge">Mortality~s(Week, k = length(unique(data1$Week)),bs='cc')</code>
                <ul>
                  <li>
<code class="language-plaintext highlighter-rouge">bs="tp"</code> :  for <strong>Thin Plate Splines</strong>
</li>
                  <li>
<code class="language-plaintext highlighter-rouge">bs="cr"</code> : for <strong>Cubic Splines</strong>
</li>
                  <li>
<code class="language-plaintext highlighter-rouge">bs="cc"</code> : for <strong>cyclic cubuc splines</strong>. Useful ifa cov shows cyclical trend like ‘Year’,’Month’</li>
                  <li>
<strong><em>Generalized Cross Validation Score</em></strong> is given within <code class="language-plaintext highlighter-rouge">summary(model)</code>’s GCV value. Use <code class="language-plaintext highlighter-rouge">method="GCV.Cp"</code> while fitting.</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">mgcv</span><span class="p">)</span><span class="w">
</span><span class="n">form.1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"Mortality~Year+s(Week, k = length(unique(data1$Week)))"</span><span class="p">)</span><span class="w">
</span><span class="n">fit1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gam</span><span class="p">(</span><span class="n">form.1</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gaussian</span><span class="p">(),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data1</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'REML'</span><span class="p">)</span><span class="w">
</span><span class="n">for.2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"Mortality~Year+s(Week, k = length(unique(data1$Week)))+
                  s(Year, Influenza)"</span><span class="p">)</span><span class="w">
</span><span class="n">fit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gam</span><span class="p">(</span><span class="n">for.2</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gaussian</span><span class="p">(),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data1</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'REML'</span><span class="p">)</span><span class="w">
</span><span class="c1"># Gives siginificance of smooth terms and variance of the model</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">fit1</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># Plotting the Residuals</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">gam.check</span><span class="p">(</span><span class="n">fit1</span><span class="p">)</span><span class="w">
</span><span class="c1"># Plot the Spline Component</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fit1</span><span class="p">)</span><span class="w">  
</span><span class="n">plot</span><span class="p">(</span><span class="n">fit1</span><span class="p">,</span><span class="w"> </span><span class="n">residuals</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="c1"># With Residuals</span><span class="w">
</span><span class="c1"># Compare Models</span><span class="w">
</span><span class="n">anova</span><span class="p">(</span><span class="n">fit1</span><span class="p">,</span><span class="n">fit2</span><span class="p">,</span><span class="w"> </span><span class="n">fit3</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Chisq'</span><span class="p">)</span><span class="w">
</span><span class="n">AIC</span><span class="p">(</span><span class="n">fit1</span><span class="p">,</span><span class="n">fit2</span><span class="p">,</span><span class="w"> </span><span class="n">fit3</span><span class="p">)</span><span class="w"> </span><span class="c1"># Choose with lowest AIC</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-kde">
<a class="anchor" href="#2-kde" aria-hidden="true"><span class="octicon octicon-link"></span></a>Kernel Classification(using Kernel Density Estimation)</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># January-2021 exam</span><span class="w">
</span><span class="c1"># data generation</span><span class="w">
</span><span class="n">N_class1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1500</span><span class="w">
</span><span class="n">N_class2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">data_class1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">N_class1</span><span class="p">){</span><span class="w">
  </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w">
  </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">data_class1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">data_class1</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">data_class2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">N_class2</span><span class="p">){</span><span class="w">
  </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">)</span><span class="w">
  </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">data_class2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">data_class2</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># y=1,0</span><span class="w">
</span><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">data_class1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">data_class2</span><span class="p">,</span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="c1"># Prior Probabilities</span><span class="w">
</span><span class="n">p_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1500</span><span class="o">/</span><span class="m">2500</span><span class="w">
</span><span class="n">P_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p_1</span><span class="w">
</span><span class="c1"># Define the Kernel</span><span class="w">
</span><span class="n">kernel</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">h</span><span class="p">){</span><span class="nf">return</span><span class="p">(</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">))}</span><span class="w">
</span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="c1"># Data to be tested on</span><span class="w">
</span><span class="n">kern.prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1"># For Storing Posterior Class probability</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">xs</span><span class="p">)){</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
  </span><span class="n">diff_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">df1</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># For class-1 only use class-1 data</span><span class="w">
  </span><span class="n">diff_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">-</span><span class="w"> </span><span class="n">df2</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># For class-2 only use class-2 data</span><span class="w">
  </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">diff_1</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kernel</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">))</span><span class="w"> </span><span class="c1"># P(X=x|Y = 'class 1')</span><span class="w">
  </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">diff_2</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kernel</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">))</span><span class="w"> </span><span class="c1"># P(X=x|Y = 'class 2')</span><span class="w">
  </span><span class="n">kern.prob</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="o">*</span><span class="n">p_1</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">p1</span><span class="o">*</span><span class="n">p_1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="o">*</span><span class="w"> </span><span class="n">P_2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1"># Applying Bayes Theorem</span><span class="w">
  </span><span class="n">kern.prob</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="o">*</span><span class="n">P_2</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">p1</span><span class="o">*</span><span class="n">p_1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="o">*</span><span class="w"> </span><span class="n">P_2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1"># this is also equal to 1 - kern.prob[i,1]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># Check the Plots</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kern.prob</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">kern.prob</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-lda">
<a class="anchor" href="#2-lda" aria-hidden="true"><span class="octicon octicon-link"></span></a>LDA(Manual implementation can be extended to QDA and Naive Bayes)</h3>

<ul>
  <li>Inputs are assumed to be <strong>CONTINUOUS</strong>
</li>
  <li>All Classes share the same covariance matrix(In QDA, they don’t)</li>
  <li>Because of ‘common covariance matrix’ assumption, the decision boundary corresponding to Posterior Probability $p(C_k|\textbf{x})$ are constant and can be respresented by  a linear function of $\textbf{x}$ i.e., “decision boundaries are linear in input space”.</li>
  <li>Since, we estimate the parameters using MLE, the approach is susceptible to ‘outliers’.</li>
  <li>While plotting, make the <code class="language-plaintext highlighter-rouge">xlim</code> and <code class="language-plaintext highlighter-rouge">ylim</code> of <code class="language-plaintext highlighter-rouge">generated data</code> same as Old Data.</li>
  <li>Use only diagonal elements of pooled-covariance matrix to perform Naive Bayes.</li>
  <li>Use different covariance matrix for each class to perform QDA</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span><span class="w"> </span><span class="c1"># Step-1: Library</span><span class="w">
</span><span class="n">crabs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">'australian-crabs.csv'</span><span class="p">)))</span><span class="w">
</span><span class="n">crabs</span><span class="o">$</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">sex</span><span class="p">)</span><span class="w"> </span><span class="c1"># Step-0:Convert the target to factor</span><span class="w">
</span><span class="c1"># Plot for Classes</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Main"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="o">=</span><span class="s1">'Male'</span><span class="p">),</span><span class="w"> </span><span class="n">points</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="o">!=</span><span class="s1">'Male'</span><span class="p">),</span><span class="w"> </span><span class="n">points</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Male"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Female"</span><span class="p">))</span><span class="w">
</span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s1">'sex~CL+RW'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Step-2 formulation</span><span class="w">
</span><span class="n">lda.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lda</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">prior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.9</span><span class="p">))</span><span class="w"> </span><span class="c1"># Step-3, prior order as 'factor' order</span><span class="w">
</span><span class="n">crabs</span><span class="p">[,</span><span class="s1">'predictions'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lda.model</span><span class="p">,</span><span class="n">crabs</span><span class="p">)</span><span class="o">$</span><span class="n">class</span><span class="w"> </span><span class="c1"># Step-4</span><span class="w">
</span><span class="c1"># Plot- Multiple Predictions, Multiple CLasses</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">oma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prior"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">)</span><span class="w">
  </span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="o">=</span><span class="s1">'Male'</span><span class="p">),</span><span class="w"> </span><span class="n">points</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">))</span><span class="w">
  </span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="o">!=</span><span class="s1">'Male'</span><span class="p">),</span><span class="w"> </span><span class="n">points</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
  </span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Male"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Female"</span><span class="p">))</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Posterior"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">)</span><span class="w">
  </span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">predictions</span><span class="o">=</span><span class="s1">'Male'</span><span class="p">),</span><span class="w"> </span><span class="n">points</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">))</span><span class="w">
  </span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">predictions</span><span class="o">!=</span><span class="s1">'Male'</span><span class="p">),</span><span class="w"> </span><span class="n">points</span><span class="p">(</span><span class="n">CL</span><span class="p">,</span><span class="w"> </span><span class="n">RW</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
  </span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Male"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Female"</span><span class="p">))</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="c1"># Draw discriminant Line</span><span class="w">
</span><span class="n">np</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lda.model</span><span class="o">$</span><span class="n">N</span><span class="w">
</span><span class="n">nd.x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">RW</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">RW</span><span class="p">),</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">)</span><span class="w">
</span><span class="n">nd.y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">CL</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">CL</span><span class="p">),</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">)</span><span class="w">
</span><span class="n">nd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">expand.grid</span><span class="p">(</span><span class="n">RW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd.x</span><span class="p">,</span><span class="w"> </span><span class="n">CL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd.y</span><span class="p">)</span><span class="w">
</span><span class="n">prd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">lda.model</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd</span><span class="p">)</span><span class="o">$</span><span class="n">class</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">crabs</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'RW'</span><span class="p">,</span><span class="s1">'CL'</span><span class="p">)],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crabs</span><span class="o">$</span><span class="n">sex</span><span class="p">)</span><span class="w"> </span><span class="c1"># Make Sure X and Y are ordered correctly</span><span class="w">
</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd.x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd.y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">prd</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">),</span><span class="w"> 
        </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">drawlabels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Manual LDA</span><span class="w">
</span><span class="c1"># Compute Mean, covMat, priorProb</span><span class="w">
</span><span class="n">setosa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">iris2</span><span class="p">[</span><span class="n">iris2</span><span class="o">$</span><span class="n">Species</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'setosa'</span><span class="p">,])</span><span class="w">
</span><span class="n">versicolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">iris2</span><span class="p">[</span><span class="n">iris2</span><span class="o">$</span><span class="n">Species</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'versicolor'</span><span class="p">,])</span><span class="w">
</span><span class="n">virginica</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">iris2</span><span class="p">[</span><span class="n">iris2</span><span class="o">$</span><span class="n">Species</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'virginica'</span><span class="p">,])</span><span class="w">
</span><span class="c1">## Means, COvs and Prior Probs</span><span class="w">
</span><span class="n">cov_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'Sepal.Width'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Sepal.Length'</span><span class="p">)</span><span class="w">
</span><span class="n">mu_setosa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="n">setosa</span><span class="p">[,</span><span class="n">cov_names</span><span class="p">]))</span><span class="w">
</span><span class="n">mu_ver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="n">versicolor</span><span class="p">[,</span><span class="n">cov_names</span><span class="p">]))</span><span class="w">
</span><span class="n">mu_vir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">colMeans</span><span class="p">(</span><span class="n">virginica</span><span class="p">[,</span><span class="n">cov_names</span><span class="p">]))</span><span class="w">
</span><span class="n">cov_setosa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cov</span><span class="p">(</span><span class="n">setosa</span><span class="p">[,</span><span class="n">cov_names</span><span class="p">])</span><span class="w">
</span><span class="n">cov_versi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cov</span><span class="p">(</span><span class="n">versicolor</span><span class="p">[,</span><span class="n">cov_names</span><span class="p">])</span><span class="w">
</span><span class="n">cov_virgi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cov</span><span class="p">(</span><span class="n">virginica</span><span class="p">[,</span><span class="n">cov_names</span><span class="p">])</span><span class="w">
</span><span class="n">prop_setosa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="o">/</span><span class="m">150</span><span class="w">
</span><span class="n">prob_ver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="o">/</span><span class="m">150</span><span class="w">
</span><span class="n">prop_virg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">-</span><span class="p">(</span><span class="n">prop_setosa</span><span class="o">+</span><span class="n">prob_ver</span><span class="p">)</span><span class="w">
</span><span class="c1">## Pooled Covariance: Bishop eq 4.78(In case of QDA dont use pooled)</span><span class="w">
</span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">((</span><span class="n">prop_setosa</span><span class="o">*</span><span class="n">cov_setosa</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">prop_virg</span><span class="o">*</span><span class="n">cov_virgi</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">prob_ver</span><span class="o">*</span><span class="n">cov_versi</span><span class="p">))</span><span class="w">
</span><span class="n">s_inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">solve</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="w">
</span><span class="c1"># Calculate Discriminant FUnction</span><span class="w">
</span><span class="n">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">150</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">p_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">prop_setosa</span><span class="p">,</span><span class="n">prob_ver</span><span class="p">,</span><span class="n">prop_virg</span><span class="p">)</span><span class="w">
</span><span class="n">mus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">mu_setosa</span><span class="p">,</span><span class="n">mu_ver</span><span class="p">,</span><span class="w"> </span><span class="n">mu_vir</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">150</span><span class="p">){</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">){</span><span class="w">
    </span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">iris2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">cov_names</span><span class="p">])</span><span class="o">%*%</span><span class="n">s_inv</span><span class="o">%*%</span><span class="n">mus</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.5</span><span class="o">*</span><span class="n">t</span><span class="p">(</span><span class="n">mus</span><span class="p">[,</span><span class="n">j</span><span class="p">])</span><span class="o">%*%</span><span class="n">s_inv</span><span class="o">%*%</span><span class="n">mus</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'setosa'</span><span class="p">,</span><span class="s1">'versicolor'</span><span class="p">,</span><span class="s1">'virginica'</span><span class="p">)</span><span class="w">
</span><span class="n">actual_predictions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="m">150</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">150</span><span class="p">){</span><span class="w">
  </span><span class="n">actual_predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">classes</span><span class="p">[</span><span class="n">which.max</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">,])]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># Sampling From New Sample</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">mvtnorm</span><span class="p">)</span><span class="w">
</span><span class="c1">## Generate synthetic data for each class i.e., x ~ N(mu_k,Sigma)</span><span class="w">
</span><span class="c1"># Ex for setosa: rmvnorm(50, mean = mu_setosa, sigma = S)</span><span class="w">
</span><span class="n">syn_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">rmvnorm</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu_setosa</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">),</span><span class="w"> </span><span class="s1">'setosa'</span><span class="p">),</span><span class="w">
</span><span class="n">cbind</span><span class="p">(</span><span class="n">rmvnorm</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu_ver</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">),</span><span class="w"> </span><span class="s1">'versicolor'</span><span class="p">),</span><span class="w">
</span><span class="n">cbind</span><span class="p">(</span><span class="n">rmvnorm</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu_vir</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">),</span><span class="w"> </span><span class="s1">'virginica'</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">syn_data</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'Sepal.Width'</span><span class="p">,</span><span class="s1">'Sepal.Length'</span><span class="p">,</span><span class="s1">'Species'</span><span class="p">)</span><span class="w">
</span><span class="n">syn_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">syn_data</span><span class="p">)</span><span class="w">
</span><span class="c1">## Plot and comparing Synthetic Data with actual data</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">oma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Main"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">Species</span><span class="o">=</span><span class="s1">'setosa'</span><span class="p">),</span><span class="w"> </span><span class="n">points</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">Species</span><span class="o">!=</span><span class="s1">'setosa'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Species</span><span class="w"> </span><span class="o">!=</span><span class="s1">'versicolor'</span><span class="p">)),</span><span class="w"> 
     </span><span class="n">points</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">Species</span><span class="o">!=</span><span class="s1">'setosa'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Species</span><span class="w"> </span><span class="o">!=</span><span class="s1">'virginica'</span><span class="p">)),</span><span class="w"> 
     </span><span class="n">points</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'green'</span><span class="p">))</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s1">'green'</span><span class="p">),</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"setosa"</span><span class="p">,</span><span class="w"> </span><span class="s2">"virginica"</span><span class="p">,</span><span class="s1">'versicolor'</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">syn_data</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Synthetic Data"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">syn_data</span><span class="p">,</span><span class="w"> </span><span class="n">Species</span><span class="o">=</span><span class="s1">'setosa'</span><span class="p">),</span><span class="w"> </span><span class="n">points</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">syn_data</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">Species</span><span class="o">!=</span><span class="s1">'setosa'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Species</span><span class="w"> </span><span class="o">!=</span><span class="s1">'versicolor'</span><span class="p">)),</span><span class="w"> 
     </span><span class="n">points</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">syn_data</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">Species</span><span class="o">!=</span><span class="s1">'setosa'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Species</span><span class="w"> </span><span class="o">!=</span><span class="s1">'virginica'</span><span class="p">)),</span><span class="w"> 
     </span><span class="n">points</span><span class="p">(</span><span class="n">Sepal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">Sepal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'green'</span><span class="p">))</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s1">'green'</span><span class="p">),</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"setosa"</span><span class="p">,</span><span class="w"> </span><span class="s2">"virginica"</span><span class="p">,</span><span class="s1">'versicolor'</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-qda">
<a class="anchor" href="#2-qda" aria-hidden="true"><span class="octicon octicon-link"></span></a>QDA</h3>

<ul>
  <li>Refer LDA codes for Templates. For Manual application use LDA template and modify individual sigma, refer ISLR eq. 4.19</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### QDA</span><span class="w">
</span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s1">'sex~CL+RW'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Step-2 formulation</span><span class="w">
</span><span class="n">qda.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qda</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">crabs</span><span class="p">,</span><span class="w"> </span><span class="n">prior</span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">))</span><span class="w"> </span><span class="c1"># Step-3</span><span class="w">
</span><span class="n">crabs</span><span class="p">[,</span><span class="s1">'qdapredictions'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">qda.model</span><span class="p">,</span><span class="n">crabs</span><span class="p">)</span><span class="o">$</span><span class="n">class</span><span class="w">
</span><span class="c1"># Misclassification Error</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">crabs</span><span class="o">$</span><span class="n">qdapredictions</span><span class="p">)</span><span class="w">
</span><span class="c1"># Draw discriminant Line</span><span class="w">
</span><span class="n">np</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qda.model</span><span class="o">$</span><span class="n">N</span><span class="w">
</span><span class="n">nd.x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">RW</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">RW</span><span class="p">),</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">)</span><span class="w">
</span><span class="n">nd.y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">CL</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">crabs</span><span class="o">$</span><span class="n">CL</span><span class="p">),</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">)</span><span class="w">
</span><span class="n">nd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">expand.grid</span><span class="p">(</span><span class="n">RW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd.x</span><span class="p">,</span><span class="w"> </span><span class="n">CL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd.y</span><span class="p">)</span><span class="w">
</span><span class="n">prd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">qda.model</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd</span><span class="p">)</span><span class="o">$</span><span class="n">class</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">crabs</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'RW'</span><span class="p">,</span><span class="s1">'CL'</span><span class="p">)],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crabs</span><span class="o">$</span><span class="n">qdapredictions</span><span class="p">)</span><span class="w"> </span><span class="c1"># Make Sure X and Y are ordered correctly</span><span class="w">
</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd.x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nd.y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">prd</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">),</span><span class="w"> 
        </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">drawlabels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-dt">
<a class="anchor" href="#2-dt" aria-hidden="true"><span class="octicon octicon-link"></span></a>Decision Trees: Classification/Regression</h3>

<ul>
  <li>Lesser the <em>residual Mean deviance</em>.better the model. <em>Residual Mean Deviance</em> = $\frac{\text{deviance}}{n- |T_o|}$ where $n= \text{no. of data points}$ and $T_o=\text{No. of Terminal Nodes}$</li>
  <li>
<em>Deviance</em> = $-2 \sum_m \sum_k n_{mk} \cdot log \hat{p}<em>{mk}$ where $n</em>{mk}$ is the no. of obs in the <em>m</em>th terminal node belonging to the <em>k</em>th class</li>
  <li>Optimal Tree can be selected using:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">cv.tree()</code></li>
      <li>Trai/Test Validation</li>
    </ol>
  </li>
  <li>In <em>Regression</em> Trees, the deviance is ‘Sum of Square Errors’ for the Tree!.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Classification</span><span class="w">
</span><span class="n">credit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">'creditscoring.xls'</span><span class="p">))</span><span class="w">
</span><span class="n">credit</span><span class="o">$</span><span class="n">good_bad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">credit</span><span class="o">$</span><span class="n">good_bad</span><span class="p">)</span><span class="w"> </span><span class="c1"># Labels need to be factored!</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span><span class="w"> </span><span class="c1"># Call the Library </span><span class="w">
</span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"good_bad~."</span><span class="p">)</span><span class="w"> </span><span class="c1"># Create the formula</span><span class="w">
</span><span class="c1"># NOTE: split = 'gini' for gini-index</span><span class="w">
</span><span class="n">train.tree.dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">,</span><span class="w"> </span><span class="n">split</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'deviance'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Fit the model on 'Train'</span><span class="w">
</span><span class="n">train.tree.gini</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="w"> </span><span class="n">split</span><span class="o">=</span><span class="s1">'gini'</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">train.tree.dev</span><span class="p">);</span><span class="n">summary</span><span class="p">(</span><span class="n">train.tree.gini</span><span class="p">)</span><span class="w">
</span><span class="c1">## Choosing Optimal Tree</span><span class="w">
</span><span class="c1"># 1. By Penalizing</span><span class="w">
</span><span class="c1"># ------------------</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">)</span><span class="w">
</span><span class="n">cv.res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.tree</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prune.misclass</span><span class="p">)</span><span class="w"> </span><span class="c1"># By default FUN = 'deviance'</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cv.res</span><span class="o">$</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">cv.res</span><span class="o">$</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'CV-Error: Misclassification'</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s1">'Terminal Nodes'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">cv.res</span><span class="o">$</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">cv.res</span><span class="o">$</span><span class="n">dev</span><span class="p">,</span><span class="w">
     </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'CV-Error: Misclassification'</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s1">'Cost-Complexity Parameter'</span><span class="p">)</span><span class="w">
</span><span class="c1"># 5 Terminal Node looks to provide the lowest Misclassification rate.</span><span class="w">
</span><span class="c1"># 'cv.res$size' returns the no of terminal nodes.</span><span class="w">
</span><span class="c1"># NOTE: 'cv.res$dev' will return the cross-validation error and not 'deviance' which in this case </span><span class="w">
</span><span class="c1">#is misclassifcation error</span><span class="w">
</span><span class="c1"># 2. Train/Val Method</span><span class="w">
</span><span class="c1"># ------------------</span><span class="w">
</span><span class="n">trainScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">9</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">9</span><span class="p">){</span><span class="w">
  </span><span class="n">prunedTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prune.tree</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Put 'type' = 'class' in case of predictions</span><span class="w">
  </span><span class="n">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">prunedTree</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'tree'</span><span class="p">)</span><span class="c1"># Returns Tree</span><span class="w">
  </span><span class="n">trainScore</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deviance</span><span class="p">(</span><span class="n">prunedTree</span><span class="p">)</span><span class="w">
  </span><span class="n">testScore</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deviance</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">trainScore</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">trainScore</span><span class="p">,</span><span class="n">testScore</span><span class="p">),</span><span class="w"> 
                                                         </span><span class="nf">max</span><span class="p">(</span><span class="n">trainScore</span><span class="p">,</span><span class="n">testScore</span><span class="p">)),</span><span class="n">main</span><span class="o">=</span><span class="s1">'Train Score'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s1">'Deviance'</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s1">'No. of Nodes'</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">testScore</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">9</span><span class="p">],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span><span class="n">opTimalTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prune.tree</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">opTimalTree</span><span class="p">)</span><span class="w">
</span><span class="c1"># State the following in the report:Variables selected, # Terminal Nodes, Res. mean deviance, Misclassification error</span><span class="w">
</span><span class="c1"># Estimate Misclassification Rate for Test data. NOTE: type='class'</span><span class="w">
</span><span class="n">testPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">opTimalTree</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'class'</span><span class="p">)</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">test</span><span class="o">$</span><span class="n">good_bad</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">testPred</span><span class="p">)</span><span class="w">

</span><span class="c1">##### Regression Trees</span><span class="w">
</span><span class="n">formreg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"amount~."</span><span class="p">)</span><span class="w">
</span><span class="n">fitReg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">formreg</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">)</span><span class="w">
</span><span class="n">trY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fitReg</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w">
</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">((</span><span class="n">val</span><span class="o">$</span><span class="n">amount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">trY</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="c1">## RMSE</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-splines">
<a class="anchor" href="#2-splines" aria-hidden="true"><span class="octicon octicon-link"></span></a>Splines: Using base R Functions only</h3>

<ul>
  <li>Example below uses only basic r functions with <code class="language-plaintext highlighter-rouge">lm</code>
</li>
  <li>Step 1: For order-M Spline We create upto M-1 <code class="language-plaintext highlighter-rouge">degree of freedom</code> variables
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">M</span><span class="o">=</span><span class="m">5</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Day</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">poly</span><span class="p">(</span><span class="n">degree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="n">M</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="c1">## KEEP `raw=TRUE` when using poly</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Step-2: Create Truncated Power Basis functions $h(x,\xi)$ for each knot!
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="c1"># knot 𝜁=75</span><span class="w">
  </span><span class="n">h.75</span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="o">&gt;</span><span class="m">75</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="p">[,</span><span class="m">4</span><span class="p">],</span><span class="m">0</span><span class="p">)</span><span class="w">
  </span><span class="c1"># If 𝜁=80</span><span class="w">
  </span><span class="n">h.80</span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="o">&gt;</span><span class="m">80</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="p">[,</span><span class="m">4</span><span class="p">],</span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Step-3: Combine Knots and Splines
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="c1"># knot 𝜁=75</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">h.75</span><span class="p">)</span><span class="w">
  </span><span class="c1"># If knots: 𝜁=75,𝜁=80</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">h.75</span><span class="p">,</span><span class="n">h.80</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Use basis function approach to fit an order-5 spline with a single knot 𝜁=75 such that Day is the feature and Rate is the target variable.</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv2</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">"mortality_rate.csv"</span><span class="p">))</span><span class="w">
</span><span class="n">M</span><span class="o">=</span><span class="m">5</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Day</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">poly</span><span class="p">(</span><span class="n">degree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="n">M</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="c1">## KEEP `raw=TRUE` when using poly</span><span class="w">
</span><span class="n">h.75</span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="o">&gt;</span><span class="m">75</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="p">[,</span><span class="m">4</span><span class="p">],</span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">h.75</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">data</span><span class="o">$</span><span class="n">Rate</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">spline.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="s2">"V6~."</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">yPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">spline.fit</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Rate</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Day</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yPred</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h3 id="2-splines2">
<a class="anchor" href="#2-splines2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Splines: Using splines library</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Using Library Splines</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">splines</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv2</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">"mortality_rate.csv"</span><span class="p">))</span><span class="w">
</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"Rate~bs(Day, df=4, knots = 75)"</span><span class="p">)</span><span class="w"> </span><span class="c1">## Because order is 5!</span><span class="w">
</span><span class="n">spline.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">yPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">spline.fit</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Rate</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Day</span><span class="p">,</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yPred</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-logistic">
<a class="anchor" href="#2-logistic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logistic Regression</h3>

<ul>
  <li>for prediction use <code class="language-plaintext highlighter-rouge">predict(glm.fits, type = 'response')</code> script. This generates probability for $\textbf{p(Y=1|X)}$</li>
  <li>$p(Y=1|\mathbf{w,X}) = \sigma{\left(\mathbf{w^T \cdot X} \right)}$ where $\sigma(a) = \frac{1}{1 + e^{-a}}$ with a linear decision boundary  at $\mathbf{w^T\cdot X}= 0$</li>
  <li>Also $Y \sim Bern(\sigma(\mathbf{w^T \cdot X}))$</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spam</span><span class="o">$</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">spam</span><span class="o">$</span><span class="n">Spam</span><span class="o">==</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'S'</span><span class="p">,</span><span class="s1">'H'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Create a binary variable</span><span class="w">
</span><span class="n">spam</span><span class="o">$</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">spam</span><span class="o">$</span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="c1"># Convert to Factor</span><span class="w">
</span><span class="c1"># Check the factor</span><span class="w">
</span><span class="n">contrasts</span><span class="p">(</span><span class="n">spam</span><span class="o">$</span><span class="n">target</span><span class="p">)</span><span class="w">
</span><span class="n">cov</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="n">covariates</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s1">'+'</span><span class="p">)</span><span class="w">
</span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s1">'Spam~'</span><span class="p">,</span><span class="n">cov</span><span class="p">))</span><span class="w">
</span><span class="n">glm.fits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Family should be 'binomial'</span><span class="w">
</span><span class="n">test_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">glm.fits</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'response'</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="w">
</span><span class="n">test_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">test_pred</span><span class="o">&gt;</span><span class="m">0.5</span><span class="p">,</span><span class="s1">'Spam'</span><span class="p">,</span><span class="s1">'Ham'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Y=1 for 'Spam'</span><span class="w">
</span><span class="c1"># Accuracy</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">train_pred</span><span class="p">,</span><span class="w"> </span><span class="n">train</span><span class="o">$</span><span class="n">target</span><span class="p">)</span><span class="w">
</span><span class="c1"># Misclassification</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">train_pred</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">train</span><span class="o">$</span><span class="n">target</span><span class="p">)</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">test_pred</span><span class="o">==</span><span class="n">test</span><span class="o">$</span><span class="n">target</span><span class="p">)</span><span class="w">
</span><span class="c1"># TPR,FPR,ROC</span><span class="w">
</span><span class="n">pred_tree.prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">opTimalTree</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'vector'</span><span class="p">)[,</span><span class="s1">'good'</span><span class="p">]</span><span class="w"> </span><span class="c1"># Get Class Probability</span><span class="w">
</span><span class="c1"># Calculate TPR, FPR</span><span class="w">
</span><span class="n">get.rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">predicted.prob</span><span class="p">,</span><span class="w"> </span><span class="n">actual</span><span class="p">,</span><span class="w"> </span><span class="n">true_label</span><span class="p">,</span><span class="w"> </span><span class="n">false_label</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="p">){</span><span class="w">
  </span><span class="n">prediction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">predicted.prob</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">,</span><span class="w"> </span><span class="n">true_label</span><span class="p">,</span><span class="n">false_label</span><span class="p">)</span><span class="w">
  </span><span class="n">TPR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">prediction</span><span class="o">==</span><span class="n">true_label</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">true_label</span><span class="p">)</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">actual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">true_label</span><span class="p">)</span><span class="w">
  </span><span class="n">FPR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">prediction</span><span class="o">==</span><span class="n">true_label</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">false_label</span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">actual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">false_label</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">TPR</span><span class="p">,</span><span class="w"> </span><span class="n">FPR</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">thresholds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="m">0.95</span><span class="p">,</span><span class="m">0.05</span><span class="p">)</span><span class="w">
</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'threshold'</span><span class="p">,</span><span class="s1">'TPR'</span><span class="p">,</span><span class="w"> </span><span class="s1">'FPR'</span><span class="p">)</span><span class="w">
</span><span class="n">tree.roc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">thresholds</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">tree.roc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">cols</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)){</span><span class="w">
  </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
  </span><span class="c1"># Tree</span><span class="w">
  </span><span class="n">res.tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get.rate</span><span class="p">(</span><span class="n">pred_tree.prob</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="o">$</span><span class="n">good_bad</span><span class="p">,</span><span class="w"> </span><span class="s1">'good'</span><span class="p">,</span><span class="w"> </span><span class="s1">'bad'</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="p">)</span><span class="w">
  </span><span class="n">tree.roc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span><span class="w"> </span><span class="n">res.tree</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># PLOT ROC</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree.roc</span><span class="p">[,</span><span class="s1">'FPR'</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree.roc</span><span class="p">[,</span><span class="s1">'TPR'</span><span class="p">],</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s1">'FPR'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s1">'TPR'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h3 id="2-knn">
<a class="anchor" href="#2-knn" aria-hidden="true"><span class="octicon octicon-link"></span></a>K Nearest Neighbors</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- NOTE: How 'train' and 'validation' are evaluated. Param `k` decides on no. of neighbors. `d` decides Minkowski distance. `d=2` for `euclidean`
- theres no `predict`, use the data to be predicted in `test`   
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"kknn"</span><span class="p">)</span><span class="w">
</span><span class="c1"># k=30</span><span class="w">
</span><span class="c1"># Target has value 0 or 1</span><span class="w">
</span><span class="n">k.30.train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kknn</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="m">30</span><span class="p">,</span><span class="n">distance</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">kernel</span><span class="o">=</span><span class="s1">'rectangular'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Creating Model based on Training data as Validation</span><span class="w">
</span><span class="n">k.30.test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kknn</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="m">30</span><span class="p">,</span><span class="n">distance</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">kernel</span><span class="o">=</span><span class="s1">'rectangular'</span><span class="p">)</span><span class="w">
</span><span class="n">train.pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">k.30.train</span><span class="o">$</span><span class="n">fit</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">,</span><span class="s1">'S'</span><span class="p">,</span><span class="s1">'H'</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1"># Script to modify the prediction</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">Predicted</span><span class="o">=</span><span class="n">train.pred</span><span class="p">,</span><span class="w"> </span><span class="n">Actual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="o">$</span><span class="n">target</span><span class="p">))</span><span class="w"> </span><span class="c1"># Training Confusion</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">Predicted</span><span class="o">=</span><span class="n">test.pred</span><span class="p">,</span><span class="w"> </span><span class="n">Actual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="o">$</span><span class="n">target</span><span class="p">))</span><span class="w"> </span><span class="c1"># Test Confusion</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">train.pred</span><span class="o">==</span><span class="n">train</span><span class="o">$</span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="c1"># Accuracy</span><span class="w">
</span></code></pre></div></div>
<h3 id="2-ridge">
<a class="anchor" href="#2-ridge" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ridge Regression</h3>

<ul>
  <li>In ‘glmnet’ ‘alpha=0’ is for ridge.</li>
  <li>Make sure that input data is in <code class="language-plaintext highlighter-rouge">matrix</code> format i.e., <code class="language-plaintext highlighter-rouge">glmnet(x = as.matrix(scaled_data[,coefs[2:64]]), y = as.matrix(scaled_data[,'Fat']),
               alpha=0, lambda = grid)</code>
</li>
  <li>choosing good grid values: <code class="language-plaintext highlighter-rouge">grid &lt;- 10 ^ seq (10, -2, length = 100)</code>
</li>
  <li>use <code class="language-plaintext highlighter-rouge">type.measure="class"</code> for getting misclassification error in case of classification task.</li>
  <li>We use ‘MSE’ because :
    <ol>
      <li>It is the MLE of a normal distribution and we assume error to be normally distributed.</li>
      <li>MSE is a quadratic function i.e., it is easily differentiable and will always have a minima.</li>
    </ol>
  </li>
  <li>Effective Degrees of freedom: $df(\lambda) = tr(X(X’X + \lambda I_p)^{-1} X’)$</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Ridge Regression</span><span class="w">
</span><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">ridge.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">[,</span><span class="n">coefs</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">64</span><span class="p">]]),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scaled_data</span><span class="p">[,</span><span class="s1">'Fat'</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">)</span><span class="w">
</span><span class="c1"># 5 fold cv</span><span class="w">
</span><span class="n">cv.5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">coefs</span><span class="p">]),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="s1">'Fat'</span><span class="p">]),</span><span class="n">alpha</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">,</span><span class="n">nfolds</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">type.measure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mse"</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># Plot CV Results</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">cv.5</span><span class="o">$</span><span class="n">lambda</span><span class="p">),</span><span class="w"> </span><span class="n">cv.5</span><span class="o">$</span><span class="n">cvm</span><span class="p">,</span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'log(lambda)'</span><span class="p">,</span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.5</span><span class="o">$</span><span class="n">name</span><span class="p">)</span><span class="w">
</span><span class="c1"># Optimal lambda</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">cv.5</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h3 id="2-poisson">
<a class="anchor" href="#2-poisson" aria-hidden="true"><span class="octicon octicon-link"></span></a>Poisson Regression</h3>

<ul>
  <li>$p(y=Y|\lambda) = \frac{e^{-\lambda} \lambda^{Y}}{Y!}$</li>
  <li>For Prediction of $\hat{Y}$, we use $\hat{Y} =  e^{\mathbf{W^TX}}$ whete $\lambda = \mathbf{W^TX}$
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">yTestPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lasso.fit</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">8</span><span class="p">)]),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"response"</span><span class="p">)</span><span class="w">
</span><span class="n">yTestPred</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">yHat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">test</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">8</span><span class="p">)]))</span><span class="o">%*%</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">lasso.fit</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">prediction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">yay</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-ridge-optim">
<a class="anchor" href="#2-ridge-optim" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ridge Regression using Optim</h3>

<ul>
  <li>Use Block-1, Lab-1 Q2 as premise. Make sure to SCALE the data!!!</li>
  <li>Make sure that the <code class="language-plaintext highlighter-rouge">X</code>, <code class="language-plaintext highlighter-rouge">Y</code> and <code class="language-plaintext highlighter-rouge">Weights</code> are in <code class="language-plaintext highlighter-rouge">as.matrix</code> format.</li>
  <li>For Log-Likelihood, used Bishop eq.(3.11) and for applying ridge penalty used equation from pg.17 of <code class="language-plaintext highlighter-rouge">Lecture 1D,Block1</code>
</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="c1"># LogLikelihood = log P(Y|X,w,sigma)</span><span class="w">
  </span><span class="n">Loglikelihood</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">sigma</span><span class="p">){</span><span class="w">
  </span><span class="n">wTX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">%*%</span><span class="n">w</span><span class="w">
  </span><span class="n">loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="n">wTX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="m">0.5</span><span class="o">*</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">sigma</span><span class="p">)))</span><span class="w">
  </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="m">0.5</span><span class="o">*</span><span class="nf">log</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">))</span><span class="w">
  </span><span class="n">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="m">0.5</span><span class="o">*</span><span class="n">loss</span><span class="p">)</span><span class="w">
  </span><span class="n">logLik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="o">-</span><span class="n">t2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t3</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">logLik</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">## Ridge Penalty</span><span class="w">
  </span><span class="n">ridge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">){</span><span class="w">
    </span><span class="n">log_lik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Loglikelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span><span class="w">
    </span><span class="n">penalty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="o">*</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">w</span><span class="o">^</span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">log_lik</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">penalty</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">## Ridge Degree of Freedom</span><span class="w">
  </span><span class="n">ridge.df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lambda</span><span class="p">){</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
    </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1"># Covariate count</span><span class="w">
    </span><span class="n">Ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diag</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w">
    </span><span class="n">inv_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">%*%</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">lambda</span><span class="o">*</span><span class="n">Ip</span><span class="p">))</span><span class="w">
    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">%*%</span><span class="n">inv_data</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
    </span><span class="n">trace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">### AIC criteria</span><span class="w">
  </span><span class="n">calculate_AIC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">){</span><span class="w">
    </span><span class="n">log_lik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Loglikelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span><span class="w">
    </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># No of data points</span><span class="w">
    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ridge.df</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lambda</span><span class="p">)</span><span class="w">
    </span><span class="n">aic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">-2</span><span class="o">*</span><span class="n">log_lik</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">df</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="c1">#(-2*Log-likelihood/N) + 2*(df/N)</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">aic</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1"># Calculate Train,Test Loss</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">1000</span><span class="p">)){</span><span class="w">
    </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">covs</span><span class="p">])[</span><span class="m">2</span><span class="p">]</span><span class="w">
    </span><span class="n">initW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="w">
    </span><span class="n">sigma</span><span class="o">=</span><span class="n">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
    </span><span class="n">lambda</span><span class="o">=</span><span class="n">lambda</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">covs</span><span class="p">])</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="s1">'motor_UPDRS'</span><span class="p">])</span><span class="w">
    </span><span class="n">xTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="n">covs</span><span class="p">])</span><span class="w">
    </span><span class="n">yTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="s1">'motor_UPDRS'</span><span class="p">])</span><span class="w">
    </span><span class="n">ridgeOpt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optim</span><span class="p">(</span><span class="n">initW</span><span class="p">,</span><span class="w"> </span><span class="n">ridge</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span><span class="n">lambda</span><span class="o">=</span><span class="n">lambda</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"BFGS"</span><span class="p">))</span><span class="w">
    </span><span class="n">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">ridgeOpt</span><span class="o">$</span><span class="n">par</span><span class="p">)</span><span class="w">
    </span><span class="n">train_mse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">((</span><span class="n">x</span><span class="o">%*%</span><span class="n">weights</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">);</span><span class="n">test_mse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">((</span><span class="n">xTest</span><span class="o">%*%</span><span class="n">weights</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yTest</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
    </span><span class="n">print</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s1">'Lambda: '</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">));</span><span class="n">print</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s1">'Train Error: '</span><span class="p">,</span><span class="w"> </span><span class="n">train_mse</span><span class="p">))</span><span class="w">
    </span><span class="n">print</span><span class="p">(</span><span class="n">calculate_AIC</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">))</span><span class="w"> </span><span class="c1"># For AIC Calculation</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-lasso">
<a class="anchor" href="#2-lasso" aria-hidden="true"><span class="octicon octicon-link"></span></a>LASSO</h3>

<ul>
  <li>
<strong>Standardize</strong> the data!</li>
  <li>Almost same as Ridge. But, <code class="language-plaintext highlighter-rouge">df</code>(degree of freedom) is also covered.</li>
  <li>Example of how to generate synthetic data is below.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="c1"># Lasso Regression</span><span class="w">
  </span><span class="n">lasso.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">coefs</span><span class="p">]),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="s1">'Fat'</span><span class="p">]),</span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s2">"gaussian"</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Plotting Lambda V/S Coefficients</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">lasso.fit</span><span class="p">,</span><span class="w"> </span><span class="n">xvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lambda"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Plot LASSO V/S df</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">lasso.fit</span><span class="o">$</span><span class="n">lambda</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso.fit</span><span class="o">$</span><span class="n">df</span><span class="p">)</span><span class="w">
  </span><span class="c1">## Cross Validation</span><span class="w">
  </span><span class="n">lasso.grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
  </span><span class="c1"># 5 fold cv</span><span class="w">
  </span><span class="n">cv.5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">coefs</span><span class="p">]),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="s1">'Fat'</span><span class="p">]),</span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s2">"gaussian"</span><span class="p">,</span><span class="w">
                    </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso.grid</span><span class="p">,</span><span class="n">nfolds</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">type.measure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mse"</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Plot CV Results: MSE V/S Log(Lambda)</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">cv.5</span><span class="o">$</span><span class="n">lambda</span><span class="p">),</span><span class="w"> </span><span class="n">cv.5</span><span class="o">$</span><span class="n">cvm</span><span class="p">,</span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'log(lambda)'</span><span class="p">,</span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.5</span><span class="o">$</span><span class="n">name</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Optimal lambda</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">cv.5</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span><span class="w">
  </span><span class="c1">### Generating synthetic test data</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="n">coefs</span><span class="p">]);</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="s1">'Fat'</span><span class="p">])</span><span class="w"> </span><span class="c1"># Actual Test Data</span><span class="w">
  </span><span class="n">lasso.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">coefs</span><span class="p">]),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="s1">'Fat'</span><span class="p">]),</span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.5</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span><span class="w"> </span><span class="c1"># LASSO with best fit</span><span class="w">
  </span><span class="n">betas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.vector</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">lasso.fit</span><span class="p">)[</span><span class="m">-1</span><span class="p">,])</span><span class="w"> </span><span class="c1"># Remove intercept and fetch beta coefficients</span><span class="w">
  </span><span class="n">residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="o">$</span><span class="n">Fat</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">coefs</span><span class="p">])</span><span class="o">%*%</span><span class="w"> </span><span class="n">betas</span><span class="p">;</span><span class="n">stdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span><span class="w"> </span><span class="c1"># Residual and st dev</span><span class="w">
  </span><span class="n">yTestHat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lasso.fit</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'response'</span><span class="p">)</span><span class="w">
  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">Y</span><span class="p">)[</span><span class="m">1</span><span class="p">];</span><span class="n">set.seed</span><span class="p">(</span><span class="m">12345</span><span class="p">)</span><span class="w">
  </span><span class="n">yPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">yTestHat</span><span class="p">,</span><span class="n">stdev</span><span class="p">)</span><span class="w">
  </span><span class="c1"># PLot Actual vs generated data</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="n">yPred</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<ul>
  <li>LASSO:(Best Lambda statistically)
    <ul>
      <li>Checking For Statistically Significantly better: <code class="language-plaintext highlighter-rouge">print(lasso.fit)</code>
</li>
      <li>If %Dev explained is similar, choose one with lower ‘df’</li>
    </ul>

    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv2</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="s2">"Dailytemperature.csv"</span><span class="p">))</span><span class="w">
</span><span class="n">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="w">
</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df2</span><span class="o">$</span><span class="n">Temperature</span><span class="w">
</span><span class="n">power_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">-50</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">power_factor</span><span class="p">){</span><span class="w">
  </span><span class="n">df2</span><span class="p">[,</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"sin_"</span><span class="p">,</span><span class="nf">as.character</span><span class="p">(</span><span class="n">i</span><span class="p">))]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sin</span><span class="p">(</span><span class="m">0.5</span><span class="o">^</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span><span class="w">
  </span><span class="n">df2</span><span class="p">[,</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"cos_"</span><span class="p">,</span><span class="nf">as.character</span><span class="p">(</span><span class="n">i</span><span class="p">))]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cos</span><span class="p">(</span><span class="w"> </span><span class="m">0.5</span><span class="o">^</span><span class="n">i</span><span class="o">*</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1">## LASSO</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span><span class="w">
</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">df2</span><span class="p">)[</span><span class="m">3</span><span class="o">:</span><span class="m">204</span><span class="p">]</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">df2</span><span class="p">[,</span><span class="n">cols</span><span class="p">])</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w">
</span><span class="c1">## Dependence of DF on Penalty factor</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso.fit</span><span class="o">$</span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso.fit</span><span class="o">$</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"Degrees of Freedom V/S  Lambda"</span><span class="p">,</span><span class="w">
    </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Lambda"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DF"</span><span class="p">)</span><span class="w">
</span><span class="c1">## CV for dependence of MSE on Log-Penalty</span><span class="w">
</span><span class="n">lambdas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span><span class="w"> 
</span><span class="n">lambdas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">lambdas</span><span class="p">)</span><span class="w">
</span><span class="c1">## Ensure -4 is there in log(lambda)</span><span class="w">
</span><span class="c1">## any(log(lambdas) == -4)</span><span class="w">
</span><span class="n">cv.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s2">"gaussian"</span><span class="p">,</span><span class="w"> </span><span class="n">type.measure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mse"</span><span class="p">,</span><span class="w"> </span><span class="n">nfolds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w">
                  </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambdas</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cv.fit</span><span class="p">)</span><span class="w"> </span><span class="c1">## Plots MSE V/S log(lambda)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">cv.fit</span><span class="o">$</span><span class="n">lambda.1se</span><span class="p">)</span><span class="w"> </span><span class="c1">## Check the Standard Error</span><span class="w">
</span><span class="c1">## Checking For Statistically Significantly better</span><span class="w">
</span><span class="c1">## If %Dev explained is similar, choose one with lower 'df'</span><span class="w">
</span><span class="n">lasso3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gaussian"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="m">-4</span><span class="p">))</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">lasso3</span><span class="p">)</span><span class="w">
</span><span class="n">lasso.min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gaussian"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.fit</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">lasso.min</span><span class="p">)</span><span class="w">
</span><span class="c1">## Extracting Coefficients</span><span class="w">
</span><span class="n">coef.exact</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">lasso.min</span><span class="p">,</span><span class="n">exact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="c1">## No. of Non Zero Features</span><span class="w">
</span><span class="nf">length</span><span class="p">(</span><span class="n">coef.exact</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">coef.exact</span><span class="o">!=</span><span class="m">0</span><span class="p">)])</span><span class="w"> </span><span class="c1"># Includes Intercept!</span><span class="w">
</span><span class="c1"># Prediction</span><span class="w">
</span><span class="n">predTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lasso.min</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"link"</span><span class="p">)</span><span class="w">
</span><span class="n">predTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lasso.min</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"response"</span><span class="p">)</span><span class="w"> </span><span class="c1">## OR</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-elastic">
<a class="anchor" href="#2-elastic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elastic-Net</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">alpha</code> is between <code class="language-plaintext highlighter-rouge">0</code> and <code class="language-plaintext highlighter-rouge">1</code>.
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span><span class="w">
  </span><span class="n">Xtrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">[,</span><span class="m">-4703</span><span class="p">]</span><span class="w">
  </span><span class="n">Ytrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">[,</span><span class="m">4703</span><span class="p">]</span><span class="w">
  </span><span class="n">Xtest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">[,</span><span class="w"> </span><span class="m">-4703</span><span class="p">]</span><span class="w">
  </span><span class="n">Ytest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">[,</span><span class="m">4703</span><span class="p">]</span><span class="w">
  </span><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Classification Cross-Validation</span><span class="w">
  </span><span class="n">en.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">),</span><span class="w">
                  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ytrain</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'binomial'</span><span class="p">,</span><span class="w">
                </span><span class="n">type.measure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'class'</span><span class="p">)</span><span class="w">
  </span><span class="n">best_lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">en.fit</span><span class="o">$</span><span class="n">lambda.min</span><span class="w">
  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">),</span><span class="w">
            </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ytrain</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">best_lambda</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'binomial'</span><span class="p">)</span><span class="w">
  </span><span class="n">yTest.elastic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">Xtest</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"class"</span><span class="p">)</span><span class="w">
  </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">Ytest</span><span class="o">==</span><span class="n">yTest.elastic</span><span class="p">)</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Regularized Features: "</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="o">$</span><span class="n">df</span><span class="p">))</span><span class="w"> </span><span class="c1"># No. of Features</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>
<h3 id="2-svm">
<a class="anchor" href="#2-svm" aria-hidden="true"><span class="octicon octicon-link"></span></a>SVM</h3>

<ul>
  <li>Example also within <code class="language-plaintext highlighter-rouge">Nested Cross-Validation</code> section</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">library</span><span class="p">(</span><span class="n">kernlab</span><span class="p">)</span><span class="w">
  </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"Conference~."</span><span class="p">)</span><span class="w">
  </span><span class="n">svm.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ksvm</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">,</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"vanilladot"</span><span class="p">)</span><span class="w">
  </span><span class="n">yTest.svm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">svm.fit</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="w">
  </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">Ytest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">yTest.svm</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-bag">
<a class="anchor" href="#2-bag" aria-hidden="true"><span class="octicon octicon-link"></span></a>Experimental Estimation of Bagging Error</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="m">-10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">cov_diag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">sd_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">cov_diag</span><span class="p">))</span><span class="w">
</span><span class="n">error_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rmvnorm</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd_matrix</span><span class="p">)</span><span class="w">
</span><span class="n">error_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">error_data</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">error_data</span><span class="p">)</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Model "</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="c1">## Average Error</span><span class="w">
</span><span class="n">rmse_models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">){</span><span class="w">
  </span><span class="n">rmse_models</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">error_data</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## eq 14.9</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">e2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error_data</span><span class="o">^</span><span class="m">2</span><span class="w">
</span><span class="n">boot_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowMeans</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span><span class="o">/</span><span class="m">10</span><span class="w"> 
</span><span class="n">colMeans</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span><span class="o">%&gt;%</span><span class="n">mean</span><span class="w"> </span><span class="c1">## eq 14.10</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">boot_data</span><span class="p">)</span><span class="w">  </span><span class="c1">## eq 14.14</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">boot_data</span><span class="p">)</span><span class="w"> </span><span class="c1"># Bagging Error Histogram</span><span class="w">
</span><span class="c1">## part-3</span><span class="w">
</span><span class="n">variances</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">11</span><span class="p">)</span><span class="w">
 </span><span class="c1">## Assuming com(M1,M2) = 0</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">){</span><span class="w">
  </span><span class="c1"># Error Data Generation</span><span class="w">
  </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w">
  </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="m">-10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">))</span><span class="w">
  </span><span class="n">cov_diag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">sd_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">cov_diag</span><span class="p">))</span><span class="w">
  </span><span class="n">error_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rmvnorm</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd_matrix</span><span class="p">)</span><span class="w">
  </span><span class="c1">## Bootstrap Variance</span><span class="w">
  </span><span class="n">error_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">error_data</span><span class="p">)</span><span class="w">
  </span><span class="c1">## Lecture: 2(a) pg. 10</span><span class="w">
  </span><span class="n">error_bag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">error_data</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">B</span><span class="o">^</span><span class="m">2</span><span class="w">
  </span><span class="n">variances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">error_bag</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">error_bag</span><span class="p">))</span><span class="w"> </span><span class="c1">## Bagging Error Variance</span><span class="w">
  </span><span class="c1"># Model Avg Error Variance</span><span class="w">
  </span><span class="n">variances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">11</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">error_data</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">var</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## Variance of Average Individual Error</span><span class="w">
  
</span><span class="p">}</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Bootstrap"</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Model "</span><span class="w"> </span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">))</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">11</span><span class="p">){</span><span class="w">
  </span><span class="n">boxplot</span><span class="p">(</span><span class="n">variances</span><span class="p">[,</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">variances</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-nn-scratch">
<a class="anchor" href="#2-nn-scratch" aria-hidden="true"><span class="octicon octicon-link"></span></a>NN from Scratch</h3>

<ul>
  <li>NOTE: X and Y needs to be transposed and also Normalize X!.</li>
  <li>Example is for Classification</li>
  <li>In case of Regression:
    <ul>
      <li>
        <ol>
          <li>Use <code class="language-plaintext highlighter-rouge">A2 = Z2 # Linear Output</code> within the <code class="language-plaintext highlighter-rouge">forwardPropagation</code> function.</li>
        </ol>
      </li>
      <li>
        <ol>
          <li>Modify the Cost Computing function <code class="language-plaintext highlighter-rouge">computeCost</code>
            <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">computeCost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">cache</span><span class="p">){</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1"># No.of Datapoints</span><span class="w">
</span><span class="n">A2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="o">$</span><span class="n">A2</span><span class="w"> </span><span class="c1"># Output</span><span class="w">
</span><span class="n">cost</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">((</span><span class="n">A2</span><span class="o">-</span><span class="n">Y</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">cost</span><span class="p">)}</span><span class="w">
</span></code></pre></div>            </div>
          </li>
        </ol>
      </li>
    </ul>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">   </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv2</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">"spambase_exam.csv"</span><span class="p">))</span><span class="w">  
   </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">57</span><span class="p">)],</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">57</span><span class="p">)</span><span class="w">
   </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w">
   </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Spam</span><span class="p">)</span><span class="w">
   </span><span class="c1">## Now transpose X and Y: Important Step before Implementation</span><span class="w">
   </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> 
   </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="w">
   </span><span class="c1"># 1. Define Architecture</span><span class="w">
   </span><span class="c1"># 2. Initialize Model Params</span><span class="w">
   </span><span class="n">getLayerSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">hidden_neurons</span><span class="p">,</span><span class="w"> </span><span class="n">train</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">){</span><span class="w">
     </span><span class="n">n_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
     </span><span class="n">n_h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hidden_neurons</span><span class="w">
     </span><span class="n">n_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">Y</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">

     </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
       </span><span class="s2">"n_x"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_x</span><span class="p">,</span><span class="w">
       </span><span class="s2">"n_h"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_h</span><span class="p">,</span><span class="w">
       </span><span class="s2">"n_y"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_y</span><span class="w">
     </span><span class="p">)</span><span class="w">
     </span><span class="nf">return</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="n">layers_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getLayerSize</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="m">10</span><span class="p">)</span><span class="w">
   </span><span class="n">initializeParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">list_layer_size</span><span class="p">){</span><span class="w">
     </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">data.matrix</span><span class="p">(</span><span class="n">X</span><span class="p">))[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1">## No of Training Points</span><span class="w">
     </span><span class="n">n_x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list_layer_size</span><span class="o">$</span><span class="n">n_x</span><span class="w">
     </span><span class="n">n_h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list_layer_size</span><span class="o">$</span><span class="n">n_h</span><span class="w">
     </span><span class="n">n_y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list_layer_size</span><span class="o">$</span><span class="n">n_y</span><span class="w">

     </span><span class="n">W1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="n">n_h</span><span class="o">*</span><span class="n">n_x</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_h</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">n_x</span><span class="p">,</span><span class="w"> </span><span class="n">byrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="o">*</span><span class="m">0.01</span><span class="w">
     </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">n_h</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_h</span><span class="p">)</span><span class="w">

     </span><span class="n">W2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="n">n_y</span><span class="o">*</span><span class="n">n_h</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_y</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_h</span><span class="p">,</span><span class="w"> </span><span class="n">byrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="o">*</span><span class="m">0.01</span><span class="w">
     </span><span class="n">b2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">n_y</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_y</span><span class="p">)</span><span class="w">

     </span><span class="n">params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"W1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">W1</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"b1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> 
                    </span><span class="s2">"W2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">W2</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"b2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b2</span><span class="p">)</span><span class="w">

     </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="n">pars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initializeParameters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">layers_size</span><span class="p">)</span><span class="w">
   </span><span class="c1">## Activations</span><span class="w">
   </span><span class="n">sigmoid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
     </span><span class="nf">return</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)))</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="c1">## Using Tanh in the hidden layer</span><span class="w">
   </span><span class="c1">## Sigmoid in the Output Layer</span><span class="w">
   </span><span class="n">forwardPropagation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">list_layer_size</span><span class="p">){</span><span class="w">
     </span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w">
     </span><span class="n">n_h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list_layer_size</span><span class="o">$</span><span class="n">n_h</span><span class="w">
     </span><span class="n">n_y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list_layer_size</span><span class="o">$</span><span class="n">n_y</span><span class="w">
     </span><span class="n">W1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">W1</span><span class="w">
     </span><span class="n">b1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">b1</span><span class="w">
     </span><span class="n">W2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">W2</span><span class="w">
     </span><span class="n">b2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">b2</span><span class="w">
     </span><span class="n">b1_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_h</span><span class="p">)</span><span class="w">
     </span><span class="n">b2_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_y</span><span class="p">)</span><span class="w">
     </span><span class="c1"># Input to Hiddem</span><span class="w">
     </span><span class="n">Z1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">W1</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b1_new</span><span class="w">
     </span><span class="n">A1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tanh</span><span class="p">(</span><span class="n">Z1</span><span class="p">)</span><span class="w">
     </span><span class="c1"># A1 &lt;- sigmoid(Z1) # For Sigmoid in input layer</span><span class="w">
     </span><span class="c1"># Hidden to Output</span><span class="w">
     </span><span class="n">Z2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">W2</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">A1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b2_new</span><span class="w">
     </span><span class="c1"># A2 = Z2 # Linear Output</span><span class="w">
     </span><span class="n">A2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sigmoid</span><span class="p">(</span><span class="n">Z2</span><span class="p">)</span><span class="w"> </span><span class="c1"># For Sigmoid</span><span class="w">
     </span><span class="n">cache</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"Z1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Z1</span><span class="p">,</span><span class="w">
                   </span><span class="s2">"A1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A1</span><span class="p">,</span><span class="w"> 
                   </span><span class="s2">"Z2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Z2</span><span class="p">,</span><span class="w">
                   </span><span class="s2">"A2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A2</span><span class="p">)</span><span class="w">
     </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="n">fwd_prop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forwardPropagation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">pars</span><span class="p">,</span><span class="w"> </span><span class="n">layers_size</span><span class="p">)</span><span class="w">
   </span><span class="n">lapply</span><span class="p">(</span><span class="n">fwd_prop</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
   </span><span class="c1">## Classification</span><span class="w">
   </span><span class="n">computeCost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">cache</span><span class="p">){</span><span class="w">
     </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1"># No.of Datapoints</span><span class="w">
     </span><span class="n">A2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="o">$</span><span class="n">A2</span><span class="w"> </span><span class="c1"># Output</span><span class="w">
     </span><span class="c1"># Binary Loss</span><span class="w">
     </span><span class="n">logprobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">A2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">A2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">Y</span><span class="p">))</span><span class="w">
     </span><span class="n">cost</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">-</span><span class="nf">sum</span><span class="p">(</span><span class="n">logprobs</span><span class="o">/</span><span class="n">m</span><span class="p">)</span><span class="w">
     </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">cost</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="c1">## If Regression</span><span class="w">
   </span><span class="c1">#computeCost = function(X,Y,cache){</span><span class="w">
   </span><span class="c1">#  m = dim(X)[2] # No.of Datapoints</span><span class="w">
   </span><span class="c1">#  A2 = cache$A2 # Output</span><span class="w">
   </span><span class="c1">#  cost &lt;- mean((A2-Y)^2)</span><span class="w">
   </span><span class="c1">#  return (cost)</span><span class="w">
   </span><span class="c1">#}</span><span class="w">
   </span><span class="n">cost</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">computeCost</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">fwd_prop</span><span class="p">)</span><span class="w">
   </span><span class="n">cost</span><span class="w">
   </span><span class="n">backwardPropagation</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">list_layer_size</span><span class="p">){</span><span class="w">
     </span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w">
     </span><span class="n">n_x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list_layer_size</span><span class="o">$</span><span class="n">n_x</span><span class="w">
     </span><span class="n">n_h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list_layer_size</span><span class="o">$</span><span class="n">n_h</span><span class="w">
     </span><span class="n">n_y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list_layer_size</span><span class="o">$</span><span class="n">n_y</span><span class="w">
     </span><span class="n">A2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cache</span><span class="o">$</span><span class="n">A2</span><span class="w">
     </span><span class="n">A1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cache</span><span class="o">$</span><span class="n">A1</span><span class="w">
     </span><span class="n">W2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">W2</span><span class="w">
     </span><span class="c1"># Output Layer</span><span class="w">
     </span><span class="n">dZ2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Y</span><span class="w">
     </span><span class="n">dW2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">dZ2</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">A1</span><span class="p">))</span><span class="w"> 
     </span><span class="n">db2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">dZ2</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_y</span><span class="p">)</span><span class="w">
     </span><span class="n">db2_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="n">db2</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_y</span><span class="p">)</span><span class="w">

     </span><span class="c1"># Input Layer</span><span class="w">
     </span><span class="n">dZ1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">W2</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">dZ2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">A1</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1"># If tanh</span><span class="w">
     </span><span class="c1"># dZ1 &lt;- (t(W2) %*% dZ2) * (A1*(1*A1)) # If sigmoid</span><span class="w">
     </span><span class="n">dW1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">dZ1</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="w">
     </span><span class="n">db1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">dZ1</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_h</span><span class="p">)</span><span class="w">
     </span><span class="n">db1_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="n">db1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_h</span><span class="p">)</span><span class="w">
     </span><span class="n">grads</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"dW1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dW1</span><span class="p">,</span><span class="w"> 
                   </span><span class="s2">"db1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db1</span><span class="p">,</span><span class="w">
                   </span><span class="s2">"dW2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dW2</span><span class="p">,</span><span class="w">
                   </span><span class="s2">"db2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db2</span><span class="p">)</span><span class="w">

     </span><span class="nf">return</span><span class="p">(</span><span class="n">grads</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">

   </span><span class="n">back_prop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">backwardPropagation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">fwd_prop</span><span class="p">,</span><span class="w"> </span><span class="n">pars</span><span class="p">,</span><span class="w"> </span><span class="n">layers_size</span><span class="p">)</span><span class="w">
   </span><span class="n">lapply</span><span class="p">(</span><span class="n">back_prop</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">

   </span><span class="n">updateParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">learning_rate</span><span class="p">){</span><span class="w">
     </span><span class="n">W1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">W1</span><span class="w">
     </span><span class="n">b1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">b1</span><span class="w">
     </span><span class="n">W2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">W2</span><span class="w">
     </span><span class="n">b2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="o">$</span><span class="n">b2</span><span class="w">

     </span><span class="n">dW1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grads</span><span class="o">$</span><span class="n">dW1</span><span class="w">
     </span><span class="n">db1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grads</span><span class="o">$</span><span class="n">db1</span><span class="w">
     </span><span class="n">dW2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grads</span><span class="o">$</span><span class="n">dW2</span><span class="w">
     </span><span class="n">db2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grads</span><span class="o">$</span><span class="n">db2</span><span class="w">

     </span><span class="n">W1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">W1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">learning_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dW1</span><span class="w">
     </span><span class="n">b1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">learning_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">db1</span><span class="w">
     </span><span class="n">W2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">W2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">learning_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dW2</span><span class="w">
     </span><span class="n">b2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">learning_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">db2</span><span class="w">

     </span><span class="n">updated_params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"W1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">W1</span><span class="p">,</span><span class="w">
                            </span><span class="s2">"b1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w">
                            </span><span class="s2">"W2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">W2</span><span class="p">,</span><span class="w">
                            </span><span class="s2">"b2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b2</span><span class="p">)</span><span class="w">

     </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">updated_params</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="n">update_params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">updateParameters</span><span class="p">(</span><span class="n">back_prop</span><span class="p">,</span><span class="w"> </span><span class="n">pars</span><span class="p">,</span><span class="w"> </span><span class="n">learning_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">)</span><span class="w">
   </span><span class="n">lapply</span><span class="p">(</span><span class="n">update_params</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">

   </span><span class="c1">## Training</span><span class="w">
   </span><span class="n">trainModel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">num_iteration</span><span class="p">,</span><span class="w"> </span><span class="n">hidden_neurons</span><span class="p">,</span><span class="w"> </span><span class="n">lr</span><span class="p">){</span><span class="w">
    </span><span class="c1"># X = t(X) # Transpose if not done already.</span><span class="w">
    </span><span class="c1"># y = t(y)</span><span class="w">
     </span><span class="n">layer_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getLayerSize</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">hidden_neurons</span><span class="p">)</span><span class="w">
     </span><span class="n">init_params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">initializeParameters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">layer_size</span><span class="p">)</span><span class="w">
     </span><span class="n">cost_history</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">num_iteration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="n">fwd_prop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forwardPropagation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">init_params</span><span class="p">,</span><span class="w"> </span><span class="n">layer_size</span><span class="p">)</span><span class="w">
       </span><span class="n">cost</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">computeCost</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">fwd_prop</span><span class="p">)</span><span class="w">
       </span><span class="n">back_prop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">backwardPropagation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">fwd_prop</span><span class="p">,</span><span class="w"> </span><span class="n">init_params</span><span class="p">,</span><span class="w"> </span><span class="n">layer_size</span><span class="p">)</span><span class="w">
       </span><span class="n">update_params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">updateParameters</span><span class="p">(</span><span class="n">back_prop</span><span class="p">,</span><span class="w"> </span><span class="n">init_params</span><span class="p">,</span><span class="w"> </span><span class="n">learning_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lr</span><span class="p">)</span><span class="w">
       </span><span class="n">init_params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">update_params</span><span class="w">
       </span><span class="n">cost_history</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">cost_history</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">)</span><span class="w">

       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Iteration"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s2">" | Cost: "</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
     </span><span class="p">}</span><span class="w">

     </span><span class="n">model_out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"updated_params"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_params</span><span class="p">,</span><span class="w">
                       </span><span class="s2">"cost_hist"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cost_history</span><span class="p">)</span><span class="w">
     </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">model_out</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="c1">## Learning</span><span class="w">
   </span><span class="n">EPOCHS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="w">
   </span><span class="n">HIDDEN_NEURONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w">
   </span><span class="n">LEARNING_RATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="w">
   </span><span class="n">train_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">trainModel</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">hidden_neurons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HIDDEN_NEURONS</span><span class="p">,</span><span class="w"> </span><span class="n">num_iteration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPOCHS</span><span class="p">,</span><span class="w"> </span><span class="n">lr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LEARNING_RATE</span><span class="p">)</span><span class="w">
   </span><span class="c1"># Making Prediction</span><span class="w">
   </span><span class="n">makePrediction</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">hidden_neurons</span><span class="p">){</span><span class="w">
      </span><span class="c1"># X = t(X) # Transpose if doing in 'trainModel'.</span><span class="w">
     </span><span class="c1"># y = t(y)</span><span class="w">
     </span><span class="n">layer_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getLayerSize</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">hidden_neurons</span><span class="p">)</span><span class="w">
     </span><span class="n">params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">train_model</span><span class="o">$</span><span class="n">updated_params</span><span class="w">
     </span><span class="n">fwd_prop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forwardPropagation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">layer_size</span><span class="p">)</span><span class="w">
     </span><span class="n">pred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fwd_prop</span><span class="o">$</span><span class="n">A2</span><span class="w">
     </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="n">outputProb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">makePrediction</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">HIDDEN_NEURONS</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<h2 id="2-head">
<a class="anchor" href="#2-head" aria-hidden="true"><span class="octicon octicon-link"></span></a>Unsupervised Learning</h2>
<hr>

<h3 id="nsc">
<a class="anchor" href="#nsc" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nearest Shrunken Centroid</h3>

<ul>
  <li>Need to scale the <code class="language-plaintext highlighter-rouge">x</code> data</li>
  <li>Class Probability Estimate $\hat{p}<em>k(x^{*}) =$ $\frac{\mathrm{e}^{\delta_k (x^*)}}{\sum</em>{l=1}^{K} \mathrm{e}^{\delta_l (x^*)}}$
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="c1"># To Obtain Class Probability estimate</span><span class="w">
  </span><span class="n">pamr.predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="p">,</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">"posterior"</span><span class="p">,</span><span class="n">prior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">$</span><span class="n">prior</span><span class="p">,</span><span class="w"> </span><span class="n">threshold.scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">$</span><span class="n">threshold.scale</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">library</span><span class="p">(</span><span class="n">pamr</span><span class="p">)</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">read.csv2</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.csv"</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">
  </span><span class="n">data</span><span class="o">$</span><span class="n">Conference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Conference</span><span class="p">)</span><span class="w"> </span><span class="c1"># Categorical as factor</span><span class="w">
  </span><span class="c1"># Give rows name</span><span class="w">
  </span><span class="c1"># Train/Test Split</span><span class="w">
  </span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">id</span><span class="p">,]</span><span class="w">
  </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">id</span><span class="p">,]</span><span class="w">
  </span><span class="c1"># Transpose the X matrix!!!</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4702</span><span class="p">)])</span><span class="w"> 
  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">[[</span><span class="s1">'Conference'</span><span class="p">]]</span><span class="w">
  </span><span class="c1"># Modify Data</span><span class="w">
  </span><span class="n">mydata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">geneid</span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="w"> </span><span class="n">genenames</span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pamr.train</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">0.1</span><span class="p">))</span><span class="w">
  </span><span class="c1"># Cross Validation</span><span class="w">
  </span><span class="c1">#### SET SEEED!!!!!</span><span class="w">
  </span><span class="n">set.seed</span><span class="p">(</span><span class="m">12345</span><span class="p">)</span><span class="w">
  </span><span class="n">cv.results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pamr.cv</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mydata</span><span class="p">,</span><span class="w"> </span><span class="n">nfold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Plot Cross Validation Results</span><span class="w">
  </span><span class="c1"># THreshold for which error is minimum and parameters are less</span><span class="w">
  </span><span class="n">pamr.plotcv</span><span class="p">(</span><span class="n">cv.results</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Compute Confusion matrix for a threshold</span><span class="w">
  </span><span class="n">pamr.confusion</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.9</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Plot cross validated class probabilities by class</span><span class="w">
  </span><span class="n">pamr.plotcvprob</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.9</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Estimate False discovery rates and plot them</span><span class="w">
  </span><span class="n">fdr.obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pamr.fdr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">mydata</span><span class="p">)</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="n">fdr.obj</span><span class="o">$</span><span class="n">results</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fdr.obj</span><span class="o">$</span><span class="n">results</span><span class="p">[,</span><span class="m">4</span><span class="p">],</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Threshold"</span><span class="p">,</span><span class="w">
      </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"False Discovery Rate"</span><span class="p">)</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="n">fdr.obj</span><span class="o">$</span><span class="n">results</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fdr.obj</span><span class="o">$</span><span class="n">results</span><span class="p">[,</span><span class="m">4</span><span class="p">],</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Significant Genes"</span><span class="p">,</span><span class="w">
      </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"False Discovery Rate"</span><span class="p">)</span><span class="w">
  </span><span class="c1"># List Significant Genes: ALso find their names</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pamr.listgenes</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">mydata</span><span class="p">,</span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.9</span><span class="p">)</span><span class="w">
  </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="m">1</span><span class="p">])</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">train</span><span class="p">)[</span><span class="n">names</span><span class="p">]</span><span class="w"> </span><span class="c1"># Get Column Names</span><span class="w">
  </span><span class="c1"># Plot Centroids</span><span class="w">
  </span><span class="n">pamr.plotcen</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">mydata</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.9</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Prediction</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4702</span><span class="p">)])</span><span class="w"> 
  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">[[</span><span class="s1">'Conference'</span><span class="p">]]</span><span class="w">
  </span><span class="n">mydata2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">geneid</span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="w"> </span><span class="n">genenames</span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
  </span><span class="n">yTestHat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pamr.predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">mydata2</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="o">=</span><span class="m">1.9</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Class Posterior Probability</span><span class="w">
  </span><span class="n">yTest.Prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pamr.predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">mydata2</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="o">=</span><span class="m">1.9</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"posterior"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="pca">
<a class="anchor" href="#pca" aria-hidden="true"><span class="octicon octicon-link"></span></a>PCA</h3>

<ul>
  <li>For PC1: $eigen_{1\lambda_1} \cdot$column-1 + $eigen_{2\lambda_1} \cdot$ column-2 +…
    <ul>
      <li>r-equivalent: <code class="language-plaintext highlighter-rouge">PC1 = x2%*%as.matrix(eig.x$vectors[,1])</code> where $x2$ is NXD matrix and <code class="language-plaintext highlighter-rouge">eig.x$vector[,1]</code> is a <code class="language-plaintext highlighter-rouge">DX1</code> eigen-vectors for $\lambda_1$</li>
    </ul>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="c1">### Manual PCA</span><span class="w">
  </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mtcars</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mpg"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hp"</span><span class="p">)]</span><span class="w">
  </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="c1"># Standardizing</span><span class="w">
  </span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">colMeans</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="w"> </span><span class="c1">## Subrtracting Means</span><span class="w">
  </span><span class="n">cov.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cov</span><span class="p">(</span><span class="n">x3</span><span class="p">)</span><span class="w">
  </span><span class="n">eig.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eigen</span><span class="p">(</span><span class="n">cov.x</span><span class="p">)</span><span class="w">
  </span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="w">
  </span><span class="c1">## Ensure that x and y are standardized</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"x-component"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"y component"</span><span class="p">,</span><span class="w">
      </span><span class="n">main</span><span class="o">=</span><span class="s2">"Actual Data VS PCA Vectors"</span><span class="p">)</span><span class="w">
  </span><span class="c1">## Draw PC1</span><span class="w">
  </span><span class="n">arrows</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="n">arrows</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">y1</span><span class="o">=-</span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="c1">## Draw PC2</span><span class="w">
  </span><span class="n">arrows</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="n">arrows</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">y1</span><span class="o">=-</span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="c1">## Reduced Data V/S PCA</span><span class="w">
  </span><span class="n">PC1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="o">%*%</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">
  </span><span class="n">PC2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="o">%*%</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">eig.x</span><span class="o">$</span><span class="n">vectors</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="w">
  </span><span class="c1"># Reduced Data</span><span class="w">
  </span><span class="c1">## Here PC's need to be rotated</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC2</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"PC1"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"PC2"</span><span class="p">,</span><span class="w">
      </span><span class="n">main</span><span class="o">=</span><span class="s2">"Data Along PC1 and PC2"</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="m">3</span><span class="p">))</span><span class="w">
  </span><span class="n">arrows</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-3</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="n">arrows</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="n">arrows</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
  </span><span class="n">arrows</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">

  </span><span class="c1">##### Communities data example</span><span class="w">
  </span><span class="n">communities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="s1">'communities.csv'</span><span class="p">))</span><span class="w">
  </span><span class="n">covs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">communities</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">]</span><span class="w">
  </span><span class="c1"># Manual PCA</span><span class="w">
  </span><span class="c1"># Step-1: Scaling</span><span class="w">
  </span><span class="n">PCA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="n">communities</span><span class="p">[,</span><span class="n">covs</span><span class="p">])</span><span class="w">
  </span><span class="n">PCA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">PCA</span><span class="p">,</span><span class="w"> </span><span class="n">communities</span><span class="o">$</span><span class="n">ViolentCrimesPerPop</span><span class="p">)</span><span class="w">
  </span><span class="n">cor.mat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">PCA</span><span class="p">)</span><span class="w"> </span><span class="c1"># Correlation Matrix</span><span class="w">
  </span><span class="n">cov.mat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cov</span><span class="p">(</span><span class="n">PCA</span><span class="p">)</span><span class="w"> </span><span class="c1"># Covariance Matrix</span><span class="w">
  </span><span class="c1"># Step-2: Obtain  eigenvalues and eigenvectors of covariance matrix</span><span class="w">
  </span><span class="n">eig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eigen</span><span class="p">(</span><span class="n">cov.mat</span><span class="p">)</span><span class="w"> </span><span class="c1"># Eigen values and vectors</span><span class="w">
  </span><span class="c1"># Step-3: Calculate Total and Proportional Variance explained</span><span class="w">
  </span><span class="n">lambdas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eig</span><span class="o">$</span><span class="n">values</span><span class="w">
  </span><span class="c1"># First 34 will explain 95% Variance in the data</span><span class="w">
  </span><span class="n">cum_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">lambdas</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">lambdas</span><span class="p">))</span><span class="w">
  </span><span class="nf">sum</span><span class="p">(</span><span class="n">cum_var</span><span class="o">&lt;</span><span class="m">0.95</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Proportion of variance explained by 1st two Principal Components</span><span class="w">
  </span><span class="n">lambdas</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">lambdas</span><span class="p">)</span><span class="w">
  </span><span class="n">pc.result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">princomp</span><span class="p">(</span><span class="n">PCA</span><span class="p">)</span><span class="w">
  </span><span class="c1"># pc.result$centre: Specifies 'Mean' of the variables used for PCA</span><span class="w">
  </span><span class="c1"># pc.result$sdev: Specifies 'Standard Deviation' of the variables used for PCA</span><span class="w">
  </span><span class="c1"># Calculate Total and Proportional Variance explained</span><span class="w">
  </span><span class="n">pc.var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc.result</span><span class="o">$</span><span class="n">sdev</span><span class="o">^</span><span class="m">2</span><span class="w">
  </span><span class="n">pve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc.var</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">pc.var</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Plot 1st 2 Principal Components</span><span class="w">
  </span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
  </span><span class="n">PC1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc.result</span><span class="o">$</span><span class="n">scores</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w">
  </span><span class="n">PC2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc.result</span><span class="o">$</span><span class="n">scores</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">
  </span><span class="n">PCA2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">VioLentCrimesPerPop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">communities</span><span class="o">$</span><span class="n">ViolentCrimesPerPop</span><span class="p">,</span><span class="w"> </span><span class="n">PC1</span><span class="p">,</span><span class="n">PC2</span><span class="p">)</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">PCA2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">PC1</span><span class="p">,</span><span class="n">PC2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VioLentCrimesPerPop</span><span class="p">))</span><span class="o">+</span><span class="w">
          </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w">
  </span><span class="c1"># Second Order Polynomial on PC1</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poly</span><span class="p">(</span><span class="n">PC1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">raw</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">  </span><span class="c1"># MAKE SURE 'raw=TRUE'      </span><span class="w">
  </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">communities</span><span class="o">$</span><span class="n">ViolentCrimesPerPop</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">))</span><span class="w">
  </span><span class="c1"># Prediction</span><span class="w">
  </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"Y~."</span><span class="p">)</span><span class="w">
  </span><span class="n">fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="w">
  </span><span class="n">Yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Y</span><span class="p">,</span><span class="w">
      </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PC-1"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Violent Crimes'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w">
  </span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Yhat</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w">
  </span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Actual"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Predicted"</span><span class="p">),</span><span class="w">
        </span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Run Parametric Bootstrap</span><span class="w">
  </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">statistic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">mle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mle</span><span class="p">,</span><span class="n">ran.gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rng</span><span class="p">,</span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'parametric'</span><span class="p">)</span><span class="w">
  </span><span class="n">result.PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">statistic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">mle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mle</span><span class="p">,</span><span class="n">ran.gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rng</span><span class="p">,</span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'parametric'</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Plot Confidence Interval</span><span class="w">
  </span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">envelope</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span><span class="w">
  </span><span class="n">env.PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">envelope</span><span class="p">(</span><span class="n">result.PI</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w">
      </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PC-1"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Violent Crimes'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w">
  </span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Yhat</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w">  </span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
  </span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="2-head">
<a class="anchor" href="#2-head" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other Topics</h2>
<hr>

<h3 id="npb">
<a class="anchor" href="#npb" aria-hidden="true"><span class="octicon octicon-link"></span></a>Non-Parametric Bootstrap</h3>

<ul>
  <li>Assumes no distribution for the generated data.</li>
  <li><strong>USE the WHOLE TRAINING DATA</strong></li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span><span class="w">
</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">"State.csv"</span><span class="p">),</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w">
</span><span class="n">to_numeric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">6</span><span class="p">]</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">col</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">to_numeric</span><span class="p">){</span><span class="w">
  </span><span class="n">state</span><span class="p">[,</span><span class="n">col</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span><span class="s2">"."</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">[,</span><span class="n">col</span><span class="p">]))</span><span class="w"> </span><span class="c1"># String modification</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># 1. Re-order the Data based on co-variates</span><span class="w">
  </span><span class="n">state.order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">state</span><span class="o">$</span><span class="n">MET</span><span class="p">),]</span><span class="w"> </span><span class="c1"># Ascending Order</span><span class="w">
</span><span class="c1"># 2.1 Define function to 'fit' and 'predict' on the sampled data</span><span class="w">
  </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">index</span><span class="p">){</span><span class="w">
    </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">,]</span><span class="w">
    </span><span class="n">fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data1</span><span class="p">,</span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree.control</span><span class="p">(</span><span class="n">nobs</span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="n">minsize</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="w">
    </span><span class="n">prunedTree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">prune.tree</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
    </span><span class="n">Yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">prunedTree</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="p">)</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">Yhat</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="c1"># 2.2 For Prediction Intervals</span><span class="w">
  </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">index</span><span class="p">){</span><span class="w">
    </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">,]</span><span class="w">
    </span><span class="n">fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data1</span><span class="p">,</span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree.control</span><span class="p">(</span><span class="n">nobs</span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="n">minsize</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="w">
    </span><span class="n">prunedTree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">prune.tree</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
    </span><span class="n">Yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">prunedTree</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="p">)</span><span class="w">
    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">state</span><span class="o">$</span><span class="n">EX</span><span class="p">)</span><span class="w"> </span><span class="c1"># equal to #.Training Data points</span><span class="w">
    </span><span class="c1"># Now generate Y from the distribution</span><span class="w">
    </span><span class="n">predictedEX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">Yhat</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">prunedTree</span><span class="p">)))</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">predictedEX</span><span class="p">)</span><span class="w"> </span><span class="c1"># Return this]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="c1"># 3. Perform Non-Parametric Bootstrap</span><span class="w">
  </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boot</span><span class="p">(</span><span class="n">state.order</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="c1"># Confidence Interval</span><span class="w">
  </span><span class="n">result.PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boot</span><span class="p">(</span><span class="n">state.order</span><span class="p">,</span><span class="w"> </span><span class="n">f2</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="c1"># Prediction Interval</span><span class="w">
</span><span class="c1"># 4. Plot Confidence Intervals</span><span class="w">
  </span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">envelope</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span><span class="c1"># For Setting the CI</span><span class="w">
  </span><span class="n">env.PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">envelope</span><span class="p">(</span><span class="n">result.PI</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Prediction with CI</span><span class="w">
</span><span class="c1"># Prediction with CI</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">EX</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trY</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env.PI</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env.PI</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="pb-r">
<a class="anchor" href="#pb-r" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parametric Bootstrap(Regression)</h3>

<ul>
  <li>Need to modify <code class="language-plaintext highlighter-rouge">rng</code> depending upon classification or regression task!</li>
  <li>For Classification look into: <code class="language-plaintext highlighter-rouge">Parametric Bootstrap(Classification)</code>
</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span><span class="w">
</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">"State.csv"</span><span class="p">),</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w">
</span><span class="n">to_numeric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">6</span><span class="p">]</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">col</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">to_numeric</span><span class="p">){</span><span class="w">
  </span><span class="n">state</span><span class="p">[,</span><span class="n">col</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span><span class="s2">"."</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">[,</span><span class="n">col</span><span class="p">]))</span><span class="w"> </span><span class="c1"># String modification</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># 1. Compute 'mle' i.e., of model type</span><span class="w">
</span><span class="n">mle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree.control</span><span class="p">(</span><span class="n">nobs</span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="n">minsize</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="w">
</span><span class="n">residuals</span><span class="p">(</span><span class="n">mle</span><span class="p">)</span><span class="w"> </span><span class="c1"># Best way to obtain model residuals</span><span class="w">
</span><span class="c1"># 2. Define 'rng'  for data generation</span><span class="w">
</span><span class="n">rng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">mle</span><span class="p">){</span><span class="w">
  </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">EX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">EX</span><span class="p">,</span><span class="n">MET</span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">MET</span><span class="p">)</span><span class="w">
  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">EX</span><span class="p">)</span><span class="w"> </span><span class="c1"># For Whole Data</span><span class="w">
  </span><span class="c1"># Generate New Data: rnorm will be changed for classification task</span><span class="w">
  </span><span class="n">data1</span><span class="o">$</span><span class="n">EX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">mle</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data1</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">mle</span><span class="p">)))</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1">#  Statistic function: should return the estimator(Yhat)</span><span class="w">
</span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data1</span><span class="p">){</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data1</span><span class="p">,</span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree.control</span><span class="p">(</span><span class="n">nobs</span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="n">minsize</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="w"> </span><span class="c1"># Fit the Model</span><span class="w">
  </span><span class="n">Yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="c1"># newdata = input data</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">Yhat</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># Run Parametric Bootstrap</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boot</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">statistic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">mle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mle</span><span class="p">,</span><span class="n">ran.gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rng</span><span class="p">,</span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'parametric'</span><span class="p">)</span><span class="w">
</span><span class="c1">## Prediction Interval</span><span class="w">
</span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data1</span><span class="p">){</span><span class="w">
  </span><span class="c1"># Fit the Model</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data1</span><span class="p">,</span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree.control</span><span class="p">(</span><span class="n">nobs</span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="n">minsize</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="w">
  </span><span class="n">Yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="c1"># newdata = input data</span><span class="w">
  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">state</span><span class="o">$</span><span class="n">EX</span><span class="p">)</span><span class="w"> </span><span class="c1"># equal to no of Training Data points</span><span class="w">
  </span><span class="c1"># Now generate Y from the distribution</span><span class="w">
  </span><span class="n">predictedEX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">Yhat</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">mle</span><span class="p">)))</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">predictedEX</span><span class="p">)</span><span class="w"> </span><span class="c1"># Return this</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># Plot Confidence Interval</span><span class="w">
</span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">envelope</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span><span class="w">
</span><span class="n">result.PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boot</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">statistic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">mle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mle</span><span class="p">,</span><span class="w">
                 </span><span class="n">ran.gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rng</span><span class="p">,</span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'parametric'</span><span class="p">)</span><span class="w">
</span><span class="n">env.PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">envelope</span><span class="p">(</span><span class="n">result.PI</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span><span class="w">
</span><span class="c1"># Prediction with CI&amp; PI</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">EX</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">env.PI</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="n">env.PI</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">1</span><span class="p">,])),</span><span class="nf">max</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">env.PI</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="n">env.PI</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">1</span><span class="p">,]))))</span><span class="w">    
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trY</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env.PI</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w"> </span><span class="c1"># For Prediction Interval</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state.order</span><span class="o">$</span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env.PI</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w"> </span><span class="c1"># For Prediction Interval</span><span class="w">
</span></code></pre></div></div>

<h3 id="pb-c">
<a class="anchor" href="#pb-c" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parametric Bootstrap(Classification)</h3>

<ul>
  <li>Pay attention to <code class="language-plaintext highlighter-rouge">rng</code> function</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="c1"># Perform Parametric Bootstrap</span><span class="w">
    </span><span class="c1"># Since it is a classification task: 'rng' and f1 need to be modified</span><span class="w">
    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">PC1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC_one</span><span class="p">,</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digits</span><span class="o">$</span><span class="n">Y</span><span class="p">)</span><span class="w">
    </span><span class="n">data</span><span class="o">$</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Y</span><span class="p">)</span><span class="w">
    </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"Y~."</span><span class="p">)</span><span class="w">
    </span><span class="c1"># 1. Define 'mle'</span><span class="w">
    </span><span class="n">mle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s1">'binomial'</span><span class="p">)</span><span class="w">
    </span><span class="c1"># 2. Define 'rng'  for data generation</span><span class="w">
    </span><span class="n">rng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">mle</span><span class="p">){</span><span class="w">
    </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">PC1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">Y</span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="w">
    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="c1"># For Whole Data</span><span class="w">
    </span><span class="c1"># Generate New Data: rbinom for classification task</span><span class="w">
    </span><span class="n">data1</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">mle</span><span class="p">,</span><span class="w"> </span><span class="n">data1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'response'</span><span class="p">))</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="c1">#  3. Statistic function: should return the estimator(Yhat)</span><span class="w">
    </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data1</span><span class="p">){</span><span class="w">
    </span><span class="c1"># Fit the Model</span><span class="w">
    </span><span class="n">fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data1</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s1">'binomial'</span><span class="p">)</span><span class="w">
    </span><span class="c1"># newdata = input data</span><span class="w">
    </span><span class="n">Yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="c1"># Get the Link</span><span class="w">
    </span><span class="c1"># Since Predicting Confidence Interval of "Probabilities", it cannot be negative(ISLR pg.291-292)</span><span class="w">
    </span><span class="n">Yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">Yhat</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">Yhat</span><span class="p">))</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">Yhat</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="c1"># Run Parametric Bootstrap</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">statistic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">mle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mle</span><span class="p">,</span><span class="n">ran.gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rng</span><span class="p">,</span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'parametric'</span><span class="p">)</span><span class="w">
    </span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">envelope</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span><span class="c1"># For Setting the CI</span><span class="w">
    </span><span class="c1"># Plot results</span><span class="w">
    </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">PC1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yT</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
    </span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">PC1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
    </span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">PC1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">$</span><span class="n">point</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="bonferroni">
<a class="anchor" href="#bonferroni" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bonferroni Method</h3>

<ul>
  <li>When we perform several Tests simultaneously, we need to make an adjustment for risk.</li>
  <li>$H_{0j}$ :  Treatment has no effect on $j$(j will be column or row)</li>
  <li>$H_{1j}$ :  Treatment has an effect on $j$</li>
  <li>We reject $H_{0j}$ if $p_j &lt; \alpha/M$. Not useful for large M for which Bonferroni gives conservative results</li>
  <li>Choose features for which we fail to reject the Null Hypothesis!</li>
</ul>

<h3 id="b-h">
<a class="anchor" href="#b-h" aria-hidden="true"><span class="octicon octicon-link"></span></a>Benjamin-Hochberg</h3>

<ul>
  <li>$H_{0j}$ :  treatment has no effect on $j$(j will be column or row)</li>
  <li>$H_{1j}$ :  Treatment has an effect on $j$</li>
  <li>ISLR(Version 2) has example on Regression type Data. Here we deal with Classification Data:
    <ul>
      <li>In CLassification Data, divide the data for each class and conduct BH Test for each class individually.</li>
    </ul>
  </li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">gene_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">"geneexp.csv"</span><span class="p">))</span><span class="w">
  </span><span class="n">gene_data</span><span class="o">$</span><span class="n">CellType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">gene_data</span><span class="o">$</span><span class="n">CellType</span><span class="p">)</span><span class="w">
  </span><span class="n">which</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">gene_data</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="s1">'integer'</span><span class="p">)</span><span class="w"> </span><span class="c1"># Check column-type</span><span class="w">
  </span><span class="n">expnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">gene_data</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">2086</span><span class="p">]</span><span class="w"> </span><span class="c1"># X-column names</span><span class="w">
  </span><span class="n">gene_data</span><span class="p">[[</span><span class="s1">'isCD4'</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gene_data</span><span class="o">$</span><span class="n">CellType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"CD4"</span><span class="w"> </span><span class="c1"># Conditional Column for CD4 Cell type</span><span class="w">
  </span><span class="n">gene_data</span><span class="o">$</span><span class="n">isCD8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gene_data</span><span class="o">$</span><span class="n">CellType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"CD8"</span><span class="w">
  </span><span class="n">gene_data</span><span class="o">$</span><span class="n">isCD19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gene_data</span><span class="o">$</span><span class="n">CellType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"CD19"</span><span class="w">
  </span><span class="c1">## Benjamin-Hochberg</span><span class="w">
  </span><span class="c1"># 1. Specify 1, the level to which control FDR</span><span class="w">
  </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="w">
  </span><span class="c1"># 2. Compute p values for m-null hypothesis</span><span class="w">
  </span><span class="n">get_p_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">gene_type</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">){</span><span class="w">
    </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s2">"~"</span><span class="p">,</span><span class="n">gene_type</span><span class="p">))</span><span class="w"> </span><span class="c1">#</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">t.test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="o">$</span><span class="n">p.value</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">## CD4</span><span class="w">
  </span><span class="n">p.CD4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">expnames</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">get_p_value</span><span class="p">,</span><span class="w"> </span><span class="n">gene_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"isCD4"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gene_data</span><span class="p">)</span><span class="w">
  </span><span class="c1">## CD8</span><span class="w">
  </span><span class="n">p.CD8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">expnames</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">get_p_value</span><span class="p">,</span><span class="w"> </span><span class="n">gene_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"isCD8"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gene_data</span><span class="p">)</span><span class="w">
  </span><span class="c1">## CD19</span><span class="w">
  </span><span class="n">p.CD19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">expnames</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">get_p_value</span><span class="p">,</span><span class="w"> </span><span class="n">gene_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"isCD19"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gene_data</span><span class="p">)</span><span class="w">
  </span><span class="c1"># 3. Order m p-values!!!!!</span><span class="w">
  </span><span class="n">p.CD4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">p.CD4</span><span class="p">)</span><span class="w"> </span><span class="c1"># IMPORTANT step</span><span class="w">
  </span><span class="n">p.CD8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">p.CD8</span><span class="p">)</span><span class="w">
  </span><span class="n">p.CD19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">p.CD19</span><span class="p">)</span><span class="w">
  </span><span class="c1"># 4. Define L</span><span class="w">
  </span><span class="n">BH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">){</span><span class="w">
    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span><span class="w">
    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">m</span><span class="p">){</span><span class="w">
      </span><span class="k">if</span><span class="p">(</span><span class="n">pv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">q</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">m</span><span class="p">)</span><span class="w">
        </span><span class="k">break</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">i</span><span class="m">-1</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1"># 5. Reject all null hypothesis for which p_j &lt;= p_{(L)}</span><span class="w">
  </span><span class="n">BH</span><span class="p">(</span><span class="n">p.CD4</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="m">0.05</span><span class="p">)</span><span class="w"> </span><span class="c1">## No of Rejected Genes for CD4 Cell type(Choose these as important ones)</span><span class="w">
  </span><span class="c1"># Important Ones</span><span class="w">
  </span><span class="nf">names</span><span class="p">(</span><span class="n">p.CD4</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="n">BH</span><span class="p">(</span><span class="n">p.CD4</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="m">0.05</span><span class="p">)]</span><span class="w"> </span><span class="c1"># These are the important ones</span><span class="w">
  </span><span class="n">BH</span><span class="p">(</span><span class="n">p.CD8</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="m">0.05</span><span class="p">)</span><span class="w"> </span><span class="c1">## No of Rejected Genes for CD8 Cell type</span><span class="w">
  </span><span class="n">BH</span><span class="p">(</span><span class="n">p.CD19</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="m">0.05</span><span class="p">)</span><span class="w"> </span><span class="c1">## No of Rejected Genes for CD19 Cell type</span><span class="w">
  </span><span class="c1"># Plotting</span><span class="w">
  </span><span class="n">BHLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">p.CD4</span><span class="p">))</span><span class="o">/</span><span class="n">m</span><span class="w"> </span><span class="c1"># Line for BH-threshold</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">p.CD4</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">p.CD4</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s1">'Index'</span><span class="p">,</span><span class="w">
      </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"P-Value"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"CD4"</span><span class="p">)</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">p.CD4</span><span class="p">),</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BHLine</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="n-cv">
<a class="anchor" href="#n-cv" aria-hidden="true"><span class="octicon octicon-link"></span></a>N-Fold CV</h3>

<ol>
  <li>Calculate Loss using <code class="language-plaintext highlighter-rouge">loss</code>
</li>
  <li>Calculate N-Fold Loss for the data using ‘n_fold_cv’</li>
  <li>‘get.subset’ creates various column subsets. NOTE: Does not create for a single predictor.</li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xTest</span><span class="p">,</span><span class="n">yTest</span><span class="p">){</span><span class="w">
  </span><span class="c1"># Function to obtain regression coefficient using x,y</span><span class="w">
  </span><span class="c1"># Predict y_hat for 'xTest' and then calculate loss</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">intercept</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="c1">### Add Intercept</span><span class="w">
  </span><span class="n">xTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">intercept</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">xTest</span><span class="p">))</span><span class="w">
  </span><span class="n">xtx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">%*%</span><span class="n">x</span><span class="p">)</span><span class="w">
  </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xtx</span><span class="o">%*%</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">%*%</span><span class="n">y</span><span class="p">)</span><span class="w">
  </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
  </span><span class="c1"># loss =  mean(abs(y - y_hat))  ## MAE</span><span class="w">
  </span><span class="n">yHat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xTest</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="w">
  </span><span class="n">testLoss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">((</span><span class="n">yTest</span><span class="o">-</span><span class="n">yHat</span><span class="p">)</span><span class="o">**</span><span class="m">2</span><span class="p">))</span><span class="w"> 
  </span><span class="nf">return</span><span class="p">(</span><span class="n">testLoss</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">n_fold_cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">n_fold</span><span class="p">){</span><span class="w">
  </span><span class="c1">#Randomly shuffle the data</span><span class="w">
  </span><span class="n">ran_ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">ran_ind</span><span class="p">,])</span><span class="w">
  </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="n">ran_ind</span><span class="p">]</span><span class="w">
  </span><span class="c1">#Create n equally size folds</span><span class="w">
  </span><span class="n">folds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span><span class="n">breaks</span><span class="o">=</span><span class="n">n_fold</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  </span><span class="c1">#Perform 10 fold cross validation</span><span class="w">
  </span><span class="n">cv_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n_fold</span><span class="p">){</span><span class="w">
    </span><span class="c1">#Segement your data by fold using the which() function </span><span class="w">
    </span><span class="n">testIndexes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">folds</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="n">arr.ind</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
    </span><span class="n">xTest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">testIndexes</span><span class="p">,]</span><span class="w">
    </span><span class="n">yTest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="n">testIndexes</span><span class="p">]</span><span class="w">
    </span><span class="n">xTrain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="n">testIndexes</span><span class="p">,]</span><span class="w">
    </span><span class="n">yTrain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="n">testIndexes</span><span class="p">]</span><span class="w">
    </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loss</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xTrain</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yTrain</span><span class="p">,</span><span class="n">xTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xTest</span><span class="p">,</span><span class="w"> </span><span class="n">yTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yTest</span><span class="p">)</span><span class="w">
    </span><span class="n">cv_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">cv_loss</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">cv_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">cv_loss</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">cv_loss</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">get.subset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">n_folds</span><span class="p">){</span><span class="w">
  </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="c1"># No. of Co-variates</span><span class="w">
  
  </span><span class="n">col_comb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">){</span><span class="n">t</span><span class="p">(</span><span class="n">combn</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">))}</span><span class="w"> </span><span class="c1"># Function to select 'i' out of 'n'</span><span class="w">
  </span><span class="n">best_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_comb</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">)[</span><span class="m">1</span><span class="p">,]</span><span class="w"> </span><span class="c1"># Start with all columns</span><span class="w">
  </span><span class="n">loss_best</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Inf</span><span class="w">  </span><span class="c1"># Setting a very high initial value</span><span class="w">
  
  </span><span class="c1"># i accounts for no of columns</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">){</span><span class="w">
    </span><span class="n">combos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_comb</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">N</span><span class="p">)</span><span class="w">
    </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">combos</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
    </span><span class="k">for</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">rows</span><span class="p">){</span><span class="w">
      </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combos</span><span class="p">[</span><span class="n">row</span><span class="p">,]</span><span class="w">
      </span><span class="n">X_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="w"> </span><span class="n">columns</span><span class="p">])</span><span class="w">
      </span><span class="c1"># HERE n-fold validation</span><span class="w">
      </span><span class="n">curr_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_fold_cv</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">n_fold</span><span class="p">)</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">curr_loss</span><span class="o">&lt;</span><span class="n">loss_best</span><span class="p">){</span><span class="w">
        </span><span class="n">loss_best</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr_loss</span><span class="w">
        </span><span class="n">best_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">columns</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">best</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">best_cols</span><span class="p">,</span><span class="w"> </span><span class="n">loss</span><span class="w"> </span><span class="o">=</span><span class="n">loss_best</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h3 id="step-aic">
<a class="anchor" href="#step-aic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Variable Selection using StepAIC</h3>

<ol>
  <li>Can be used for both <code class="language-plaintext highlighter-rouge">aic</code> and <code class="language-plaintext highlighter-rouge">bic</code>
</li>
  <li>What are the important variables, that can be asked</li>
  <li>‘AIC’ is an information criterion and can use all the provided data. Thus, we can utilize all the provided data as information for estimating generalization capabilities of a model.</li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="c1">## Variable Selection using StepAIC</span><span class="w">
  </span><span class="n">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span><span class="w">
  </span><span class="n">d3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span><span class="w"> </span><span class="c1"># Sample Dataset</span><span class="w">
  </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fat~."</span><span class="w"> </span><span class="c1"># Set Formula</span><span class="w">
  </span><span class="n">fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">d3</span><span class="p">))</span><span class="w">
  </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stepAIC</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'both'</span><span class="p">)</span><span class="w"> </span><span class="c1"># For AIC in both the directions.</span><span class="w">
  </span><span class="n">step.BIC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stepAIC</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="nf">log</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">d3</span><span class="p">)))</span><span class="w"> </span><span class="c1"># BIC Method</span><span class="w">
  </span><span class="c1"># To get selected variables</span><span class="w">
  </span><span class="n">get.coef.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">step.func</span><span class="p">){</span><span class="w">
    </span><span class="n">STEP_COEF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="s2">"numeric"</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">coefficients</span><span class="p">(</span><span class="n">model</span><span class="p">)))</span><span class="c1"># create an empty vector of zeros</span><span class="w">
    </span><span class="nf">names</span><span class="p">(</span><span class="n">STEP_COEF</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">coefficients</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="c1">#same names</span><span class="w">
    </span><span class="n">STEP_COEF</span><span class="p">[</span><span class="nf">names</span><span class="p">(</span><span class="n">coefficients</span><span class="p">(</span><span class="n">step</span><span class="p">))]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">coefficients</span><span class="p">(</span><span class="n">step</span><span class="p">))</span><span class="c1">#fill in the ones found in step</span><span class="w">
    </span><span class="n">coef_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">STEP_COEF</span><span class="p">[</span><span class="nf">round</span><span class="p">(</span><span class="n">STEP_COEF</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="m">0</span><span class="p">])</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">coef_names</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="nested-cv">
<a class="anchor" href="#nested-cv" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nested Cross-Validation</h3>

<ul>
  <li>randomly split data in $K$ <code class="language-plaintext highlighter-rouge">outerfolds</code>
</li>
  <li>for each hyper-parameter combo, there will be an avegare combo. error <code class="language-plaintext highlighter-rouge">config_error</code> calculated using only <code class="language-plaintext highlighter-rouge">Val</code> data within inner-loop.</li>
  <li>The inner-loop consists of inner-CV for <code class="language-plaintext highlighter-rouge">innerfolds</code> times cross-validation.</li>
  <li>Look at the average evaluation for each config i.e., <code class="language-plaintext highlighter-rouge">config_error</code> and choose the hyper-parameter with lowest <code class="language-plaintext highlighter-rouge">config_error</code>
</li>
  <li>Now, with the chosen hyper-parameters, divide the data into <code class="language-plaintext highlighter-rouge">Train</code> and <code class="language-plaintext highlighter-rouge">Test</code> for each fold and save the test loss within <code class="language-plaintext highlighter-rouge">outer_cv_loss</code> for each outer fold.</li>
  <li>The average of the <code class="language-plaintext highlighter-rouge">outer_cv_loss</code> is the models <code class="language-plaintext highlighter-rouge">Generalization</code> Error.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span><span class="w">
</span><span class="n">outerfolds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c1"># No. of Outer Folds</span><span class="w">
</span><span class="n">innerfolds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c1"># No. of Inner FOlds</span><span class="w">
</span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="s1">'type~.'</span><span class="p">)</span><span class="w">
</span><span class="n">ran_ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">spam</span><span class="p">))</span><span class="w"> </span><span class="c1"># Reshuffle the Data</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spam</span><span class="p">[</span><span class="n">ran_ind</span><span class="p">,]</span><span class="w">
</span><span class="c1">#Create n equally size folds depending on 'outerfolds' value</span><span class="w">
</span><span class="n">folds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span><span class="n">breaks</span><span class="o">=</span><span class="n">outerfolds</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1">#Perform n fold cross validation</span><span class="w">
</span><span class="n">outer_cv_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="w"> </span><span class="c1"># Each Models Error</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">2.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span><span class="c1"># Outer CV</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">outerfold</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">outerfolds</span><span class="p">){</span><span class="w">
    </span><span class="n">testIndexes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">folds</span><span class="o">==</span><span class="n">outerfold</span><span class="p">,</span><span class="n">arr.ind</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
    </span><span class="n">Test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">testIndexes</span><span class="p">,]</span><span class="w">
    </span><span class="n">Train</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">testIndexes</span><span class="p">,]</span><span class="w">
    </span><span class="c1"># Hyper-Parameter Search: Use only Validation Data Error</span><span class="w">
    </span><span class="n">config_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
     </span><span class="c1"># Each 'i' should contain the required param(s) combo</span><span class="w">
      </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">params</span><span class="p">)){</span><span class="w">
        </span><span class="c1"># Inner-CV</span><span class="w">
        </span><span class="n">if_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="w"> </span><span class="c1"># Inner-Fold error for 'i' Param configuration</span><span class="w">
        </span><span class="k">for</span><span class="p">(</span><span class="n">fold</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">innerfolds</span><span class="p">){</span><span class="w">
          </span><span class="c1">#   # Use only xTrain</span><span class="w">
            </span><span class="n">ValIndexes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">folds</span><span class="o">==</span><span class="n">fold</span><span class="p">,</span><span class="n">arr.ind</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
            </span><span class="n">Val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Train</span><span class="p">[</span><span class="n">ValIndexes</span><span class="p">,]</span><span class="w"> </span><span class="c1"># kth 'inner-fold' Validation Data</span><span class="w">
            </span><span class="n">TraIN</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Train</span><span class="p">[</span><span class="o">-</span><span class="n">ValIndexes</span><span class="p">,]</span><span class="w">
            </span><span class="n">fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ksvm</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">TraIN</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s2">"rbfdot"</span><span class="p">,</span><span class="n">kpar</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="m">0.05</span><span class="p">),</span><span class="n">C</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w">
            </span><span class="n">yValHat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">Val</span><span class="p">)</span><span class="w">
            </span><span class="n">misc_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">-</span><span class="n">mean</span><span class="p">(</span><span class="n">Val</span><span class="o">$</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">yValHat</span><span class="p">)</span><span class="w"> </span><span class="c1"># Misclassification Error</span><span class="w">
            </span><span class="n">if_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">if_error</span><span class="p">,</span><span class="w"> </span><span class="n">misc_error</span><span class="p">)</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="n">config_error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">if_error</span><span class="p">)</span><span class="w"> </span><span class="c1"># Look at avg eval for each config</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="n">best_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="p">[</span><span class="n">which.min</span><span class="p">(</span><span class="n">config_error</span><span class="p">)]</span><span class="w"> </span><span class="c1"># Choose the config with the best config_error</span><span class="w">
    </span><span class="n">fit.outer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ksvm</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">Train</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s2">"rbfdot"</span><span class="p">,</span><span class="n">kpar</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="m">0.05</span><span class="p">),</span><span class="n">C</span><span class="o">=</span><span class="n">best_i</span><span class="p">)</span><span class="w">
    </span><span class="n">yTestHat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit.outer</span><span class="p">,</span><span class="w"> </span><span class="n">Test</span><span class="p">)</span><span class="w"> </span><span class="c1"># Prediction on k-th outerfold Test Data</span><span class="w">
    </span><span class="n">of_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">-</span><span class="n">mean</span><span class="p">(</span><span class="n">Test</span><span class="o">$</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">yTestHat</span><span class="p">)</span><span class="w"> </span><span class="c1"># Outer Fold Test Error</span><span class="w">
    </span><span class="n">outer_cv_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">outer_cv_loss</span><span class="p">,</span><span class="w"> </span><span class="n">of_error</span><span class="p">)</span><span class="w"> </span><span class="c1"># Its Mean is the 'Generalized Error'</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">generalization_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">outer_cv_loss</span><span class="p">)</span><span class="w"> </span><span class="c1"># Generalization error of the model.</span><span class="w">
</span></code></pre></div></div>

<h3 id="laplace">
<a class="anchor" href="#laplace" aria-hidden="true"><span class="octicon octicon-link"></span></a>Laplace Prior</h3>

<ul>
  <li>$Y_i = \mathbf{x}_i + \mathbf{\beta} + \epsilon_i, \text{i = 1,…,n}$ where $\epsilon_i \sim \textit{Laplace(0,b)}$ then, the complete data Log-Likelihood is given as,
    <ul>
      <li>$ - \ln p\left( Y| \mathbf{X}, \mathbf{\beta}, b \right) = n \ln (\textit{2b}) + \frac{1}{b} \sum_{i=1}^n \left|\mathbf{x}_i \cdot \mathbf{\beta} - Y_i \right|$</li>
    </ul>
  </li>
  <li>Creating distribution for error term $\epsilon$ where $p(\epsilon) = \frac{e^{-|\epsilon|}}{2}$</li>
  <li>
<code class="language-plaintext highlighter-rouge">e_s</code> draws from the Laplacian Error distribution with $\mu = \mathbf{0}$ and $\Sigma = \mathbf{1}$
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># Drawing Error from its Laplace distribution</span><span class="w">
</span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="p">)</span><span class="w">
</span><span class="n">dlaplace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="m">0.5</span><span class="o">*</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))}</span><span class="w">
</span><span class="n">derror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dlaplace</span><span class="p">)</span><span class="w">
</span><span class="n">e_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">25000</span><span class="p">,</span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">derror</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">e_s</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="entropy">
<a class="anchor" href="#entropy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Entropy</h3>

<ul>
  <li>Entropy $x \cdot \ln x$ is strictly convex function.
    <div class="language-r highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="p">)</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">&gt;</span><span class="m">0</span><span class="p">]</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="S-B-Iqbal/Reflexione"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/Reflexione/732a99/r/machine%20learning/liu/tdde01/2020/08/25/732A99.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/Reflexione/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/Reflexione/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/Reflexione/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/S-B-Iqbal" title="S-B-Iqbal"><svg class="svg-icon grey"><use xlink:href="/Reflexione/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/MusingIqbal" title="MusingIqbal"><svg class="svg-icon grey"><use xlink:href="/Reflexione/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
